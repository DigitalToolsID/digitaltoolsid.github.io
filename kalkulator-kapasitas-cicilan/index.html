<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- STRUKTUR SEO OPTIMAL -->
    <link rel="canonical" href="https://digitaltoolsid.github.io/kalkulator-kapasitas-cicilan/" />
    <meta name="description" content="Kalkulator Kapasitas Cicilan (Debt Service Ratio). Hitung jumlah pinjaman maksimum yang mampu Anda ambil (KPR, KTA, KKB) berdasarkan pendapatan dan utang bulanan Anda. Hindari utang berlebihan." />
    <title id="appTitle">Kalkulator Kapasitas Cicilan (Affordability Pinjaman)</title>
    <!-- Keyword potensial: kalkulator cicilan KPR, debt service ratio, maksimal pinjaman, affordability tool -->
    <link rel="alternate" hreflang="id" href="https://digitaltoolsid.github.io/kalkulator-affordability/index.html" />
    <link rel="alternate" hreflang="en" href="https://digitaltoolsid.github.io/kalkulator-affordability/index.html" />


    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Kode Google Analytic dan Adsense (Ikuti template yang dilampirkan) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7M8E7QRYNY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-7M8E7QRYNY');
    </script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js?client=ca-pub-4885884866232864"
         crossorigin="anonymous"></script>

    <!-- Konfigurasi Tailwind (Menggunakan warna yang sama) -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#2c3e50',
                        'secondary': '#3498db',
                        'primary-dark': '#1e3a8a',
                        'finance-color': '#27ae60', // Hijau Keuangan
                        'success-color': '#27ae60',
                        'danger-color': '#e74c3c',
                        'warning-color': '#f39c12',
                        'debt-color': '#c0392b', // Merah gelap untuk utang/pinjaman
                    }
                }
            }
        }
    </script>

    <style>
        /* Gaya Toggle Bahasa */
        .lang-toggle-container {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 2000;
            display: inline-flex;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 9999px;
            padding: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .lang-toggle-btn {
            padding: 6px 14px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            z-index: 10;
            color: #2c3e50;
            transition: color 0.3s ease;
            position: relative;
        }
        .lang-toggle-slider {
            position: absolute;
            top: 4px;
            left: 4px;
            height: calc(100% - 8px);
            width: calc(50% - 4px);
            background-color: #1e3a8a;
            border-radius: 9999px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 5;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        .lang-toggle-container.lang-en .lang-toggle-slider { transform: translateX(0%); }
        .lang-toggle-container.lang-id .lang-toggle-slider { transform: translateX(100%); }
        .lang-toggle-container.lang-en #lang-en { color: white; }
        .lang-toggle-container.lang-id #lang-id { color: white; }

        /* Gaya Hasil */
        .result-box { transition: all 0.5s ease-in-out; transform-origin: top center; opacity: 0; max-height: 0; overflow: hidden; }
        .result-box.visible { opacity: 1; max-height: 3000px; padding: 1.5rem; margin-top: 1.5rem; }

        /* Gaya Tombol */
        /* Perbaikan: Menggunakan warna shadow HEX eksplisit */
        .calculate-button {
            box-shadow: 0 4px #8a2a1f; /* Menggunakan warna HEX yang lebih gelap dari debt-color (#c0392b) */
            transition: transform 0.2s, box-shadow 0.2s;
            color: white !important;
        }
        .calculate-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px #8a2a1f;
        }
        .calculate-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px #8a2a1f;
        }

        /* Gaya untuk deskripsi input */
        .input-description {
            font-size: 0.75rem; /* text-xs */
            color: #6b7280; /* text-gray-500 */
            margin-top: 0.25rem;
        }
        /* PERBAIKAN CSS: Menggunakan warna latar belakang yang lebih gelap untuk ratio-bar dan memastikan border ada*/
        .ratio-bar {
            height: 20px;
            border-radius: 9999px;
            background-color: #e5e7eb; /* gray-200 */
            overflow: hidden;
            position: relative;
            margin-top: 10px;
            border: 1px solid #d1d5db; /* Garis tepi untuk visibilitas */
        }
        .ratio-fill {
            height: 100%;
            width: 0%; /* Diperlukan agar bilah tidak mengisi 100% sebelum perhitungan */
            background-color: var(--tw-success-color);
            transition: width 0.5s ease-in-out;
        }
    </style>
</head>

<body class="bg-gray-50 flex flex-col min-h-screen font-sans">

    <!-- Header -->
    <header class="bg-primary-dark text-white py-4 shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <a href="../index.html" class="text-lg font-semibold tracking-tight text-gray-200 hover:text-white transition duration-150">
                &larr; <span id="backToCatalogText">Kembali ke Katalog Alat</span>
            </a>
            <div id="languageSwitcher" class="lang-toggle-container lang-id">
                <div id="langToggleSlider" class="lang-toggle-slider"></div>
                <button id="lang-en" onclick="setLanguage('en')" class="lang-toggle-btn">EN</button>
                <button id="lang-id" onclick="setLanguage('id')" class="lang-toggle-btn">ID</button>
            </div>
            </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow p-4 sm:p-8 flex justify-center">
        <div class="w-full max-w-lg bg-white shadow-xl rounded-xl p-6 sm:p-8">

            <h1 id="headerTitle" class="text-3xl font-extrabold text-primary-dark mb-3">Kalkulator Kapasitas Cicilan</h1>
            <!-- PERBAIKAN: Menghapus bintang ganda (**) dan memastikan <strong> digunakan untuk Pinjaman Maksimum di kunci terjemahan -->
            <p id="toolSubtitle" class="text-base text-gray-700 font-medium mb-6">Ini membantu Anda menghindari utang berlebihan dan menentukan jumlah pinjaman KPR, KKB, atau KTA yang sehat secara finansial. Gunakan rasio utang terhadap pendapatan (DSR) untuk menentukan jumlah cicilan baru yang aman dan menghitung Pinjaman Maksimum yang layak Anda ajukan.</p>

            <!-- Formulir Kalkulator Affordability -->
            <form id="affordabilityForm" onsubmit="calculateAffordability(event)" class="space-y-6">

                <!-- 1. Data Pendapatan -->
                <div class="border-b pb-4 border-gray-200">
                    <h2 class="text-xl font-bold text-finance-color mb-3" id="sectionIncomeHeader">1. Data Pendapatan & Utang Saat Ini</h2>
                    <div class="space-y-4">
                        <div class="relative">
                            <label for="monthlyIncome" class="block text-sm font-medium text-gray-700 mb-1" id="labelMonthlyIncome">Total Pendapatan Bersih Bulanan (Setelah Pajak)</label>
                            <input type="text" id="monthlyIncome" inputmode="numeric" oninput="formatInput(this)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-finance-color focus:border-finance-color" placeholder="Contoh: 10.000.000" value="10000000">
                        </div>
                        <div class="relative">
                            <label for="existingDebtPayment" class="block text-sm font-medium text-gray-700 mb-1" id="labelExistingDebtPayment">Total Cicilan Utang Bulanan Saat Ini</label>
                            <input type="text" id="existingDebtPayment" inputmode="numeric" oninput="formatInput(this)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-debt-color focus:border-debt-color" placeholder="Contoh: 1.500.000" value="1500000">
                            <p class="input-description" id="descExistingDebtPayment">Masukkan total pembayaran bulanan semua utang yang sudah ada (Kredit Mobil, KTA, dll.), TIDAK termasuk sewa rumah/kontrakan.</p>
                        </div>
                    </div>
                </div>

                <!-- 2. Detail Pinjaman Baru -->
                <div class="pb-4">
                    <h2 class="text-xl font-bold text-finance-color mb-3" id="sectionNewLoanHeader">2. Detail Pinjaman Baru yang Direncanakan</h2>
                    <div class="space-y-4">
                        <div class="relative">
                            <label for="loanInterestRate" class="block text-sm font-medium text-gray-700 mb-1" id="labelLoanInterestRate">Bunga Pinjaman Tahunan (%)</label>
                            <input type="number" id="loanInterestRate" step="0.1" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-finance-color focus:border-finance-color" placeholder="Contoh: 9" value="9">
                        </div>
                        <div class="relative">
                            <label for="loanTermYears" class="block text-sm font-medium text-gray-700 mb-1" id="labelLoanTermYears">Jangka Waktu Pinjaman (Tahun)</label>
                            <input type="number" id="loanTermYears" inputmode="numeric" min="1" step="1" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-finance-color focus:border-finance-color" placeholder="Contoh: 10" value="10">
                        </div>
                        <div class="relative">
                            <label for="dsrLimit" class="block text-sm font-medium text-gray-700 mb-1" id="labelDSRLimit">Batas Rasio Utang Terhadap Pendapatan (DSR) Ideal (%)</label>
                            <input type="number" id="dsrLimit" step="1" min="10" max="50" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-debt-color focus:border-debt-color" placeholder="Contoh: 35" value="35">
                            <p class="input-description" id="descDSRLimit">Bank biasanya menetapkan batas antara 30% - 40%. Batas 35% sangat umum digunakan.</p>
                        </div>
                    </div>
                </div>

                <!-- PERBAIKAN: Menambahkan kelas bg-debt-color di sini -->
                <button type="submit" id="calculateButton" class="calculate-button w-full text-white font-semibold py-3 rounded-xl bg-debt-color hover:bg-red-700 transition duration-300">
                    Hitung Kapasitas Pinjaman Maksimum
                </button>
            </form>

            <!-- Error Alert -->
            <div id="errorAlert" class="hidden mt-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
                <span id="errorText" class="block sm:inline"></span>
            </div>

            <!-- Result Box (Hasil Perhitungan) -->
            <div id="resultBox" class="result-box bg-debt-color/5 border border-debt-color/30 rounded-xl shadow-lg">

                <h3 id="resultTitle" class="text-2xl font-bold text-debt-color mb-4 border-b pb-2">Hasil Analisis Kapasitas Pinjaman</h3>

                <!-- Teks Narasi Hasil -->
                <div id="resultSummaryText" class="p-4 rounded-lg mb-4 bg-white border border-gray-200">
                    <p class="text-lg font-bold mb-2" id="summaryTitle"></p>
                    <p id="summaryText" class="text-gray-700 text-sm"></p>
                </div>

                <!-- Metrik Kunci -->
                <h3 id="metricsHeader" class="text-xl font-bold text-primary mb-3 border-b pb-2">Metrik Batasan</h3>
                <div id="metricsContent" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <!-- Cicilan Maksimum yang Diizinkan -->
                    <div class="p-3 rounded-lg border border-gray-200 bg-white">
                        <p class="text-sm text-gray-600" id="resultMaxMonthlyInstallment">Maksimum Cicilan Bulanan Baru</p>
                        <p class="text-xl font-bold mt-1 text-finance-color" id="maxMonthlyInstallmentResult">--</p>
                    </div>
                    <!-- Pinjaman Maksimum yang Diizinkan -->
                    <div class="p-3 rounded-lg border border-gray-200 bg-white">
                        <p class="text-sm text-gray-600" id="resultMaxLoanAmount">Pinjaman Maksimum yang Mampu Diambil</p>
                        <p class="text-xl font-bold mt-1 text-debt-color" id="maxLoanAmountResult">--</p>
                    </div>
                    <!-- DSR Saat Ini -->
                    <div class="p-3 rounded-lg border border-gray-200">
                        <p class="text-sm text-gray-600" id="resultCurrentDSR">DSR Anda Saat Ini</p>
                        <p class="text-lg font-bold mt-1" id="currentDSRResult">--</p>
                    </div>
                    <!-- DSR Target -->
                    <div class="p-3 rounded-lg border border-gray-200">
                        <p class="text-sm text-gray-600" id="resultTargetDSR">DSR Target Maksimum</p>
                        <p class="text-lg font-bold mt-1 text-debt-color" id="targetDSRResult">--</p>
                    </div>
                </div>

                <!-- Visualisasi DSR -->
                <div class="mt-6">
                    <p class="text-sm font-medium text-gray-700 mb-2" id="ratioVisualHeader">Visualisasi Batas DSR</p>
                    <div class="ratio-bar">
                        <div id="ratioFill" class="ratio-fill"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1" id="ratioLegend"></p>
                </div>

            </div>

            <!-- Konten Edukasi -->
            <section class="mt-8 pt-4 border-t border-gray-200 font-sans">
                <h2 id="sectionHeader1" class="text-xl font-bold text-gray-800 mb-3">Apa itu Debt Service Ratio (DSR)?</h2>
                <p id="content1" class="text-gray-600 text-sm leading-relaxed text-justify mb-4">DSR adalah persentase total cicilan utang bulanan Anda dibagi dengan total pendapatan bulanan. Bank menggunakan rasio ini sebagai indikator kesehatan finansial Anda. Jika DSR Anda terlalu tinggi (misalnya, di atas 40%), bank akan menganggap Anda berisiko tinggi dan kemungkinan besar menolak permohonan pinjaman baru.</p>

                <h3 id="sectionHeader2" class="text-lg font-bold text-gray-800 mb-2">Mengapa Batas DSR 35% Penting?</h3>
                <p id="content2" class="text-gray-600 text-sm leading-relaxed text-justify mb-4">Batas 35% sering dianggap sebagai ambang batas aman. Ini berarti maksimal 35% dari pendapatan Anda dialokasikan untuk membayar utang. Jika rasio ini dilewati, kemampuan Anda untuk menabung, berinvestasi, dan menghadapi biaya tak terduga (dana darurat) akan terganggu secara serius, menempatkan Anda pada risiko gagal bayar yang lebih tinggi.</p>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="mt-12 py-6 border-t border-gray-200 bg-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div id="footerLinks" class="flex flex-wrap justify-center space-x-4 sm:space-x-8 text-sm font-medium text-gray-600">
                <a href="../privacy-policy.html" id="linkPrivacy" class="hover:text-secondary">Kebijakan Privasi</a>
                <span class="hidden sm:inline">|</span>
                <a href="../terms-of-service.html" id="linkTerms" class="hover:text-secondary">Ketentuan Layanan</a>
                <span class="hidden sm:inline">|</span>
                <a href="../about-us.html" id="linkAbout" class="hover:text-secondary">Tentang Kami</a>
                <span class="hidden sm:inline">|</span>
                <a href="../contact-us.html" id="linkContact" class="hover:text-secondary">Hubungi Kami</a>
            </div>
            <div class="mt-6 text-center text-xs text-gray-500">
                <span id="footerCopyright">&copy; 2025 Digital Tools ID. Semua hak dilindungi.</span>
            </div>
        </div>
    </footer>

    <script>
        // **********************************************
        // LOGIKA KALKULATOR AFFORDABILITY PINJAMAN
        // **********************************************

        const translations = {
            id: {
                // UI TEXT
                appTitle: "Kalkulator Kapasitas Cicilan (Affordability Pinjaman)",
                backToCatalogText: "Kembali ke Katalog Alat",
                headerTitle: "Kalkulator Kapasitas Cicilan",
                // PERBAIKAN: Menghapus bintang ganda (**) dan menggunakan <strong>
                toolSubtitle: "Ini membantu Anda menghindari utang berlebihan dan menentukan jumlah pinjaman KPR, KKB, atau KTA yang sehat secara finansial. Gunakan rasio utang terhadap pendapatan (DSR) untuk menentukan jumlah cicilan baru yang aman dan menghitung <strong>Pinjaman Maksimum</strong> yang layak Anda ajukan.",
                // LABELS INPUT
                sectionIncomeHeader: "1. Data Pendapatan & Utang Saat Ini",
                labelMonthlyIncome: "Total Pendapatan Bersih Bulanan (Setelah Pajak)",
                labelExistingDebtPayment: "Total Cicilan Utang Bulanan Saat Ini",
                descExistingDebtPayment: "Masukkan total pembayaran bulanan semua utang yang sudah ada (Kredit Mobil, KTA, dll.), TIDAK termasuk sewa rumah/kontrakan.",
                sectionNewLoanHeader: "2. Detail Pinjaman Baru yang Direncanakan",
                labelLoanInterestRate: "Bunga Pinjaman Tahunan (%)",
                labelLoanTermYears: "Jangka Waktu Pinjaman (Tahun)",
                labelDSRLimit: "Batas Rasio Utang Terhadap Pendapatan (DSR) Ideal (%)",
                descDSRLimit: "Bank biasanya menetapkan batas antara 30% - 40%. Batas 35% sangat umum digunakan.",
                calculateButton: "Hitung Kapasitas Pinjaman Maksimum",
                // HASIL
                resultTitle: "Hasil Analisis Kapasitas Pinjaman",
                metricsHeader: "Metrik Batasan",
                resultMaxMonthlyInstallment: "Maksimum Cicilan Bulanan Baru",
                resultMaxLoanAmount: "Pinjaman Maksimum yang Mampu Diambil",
                resultCurrentDSR: "DSR Anda Saat Ini",
                resultTargetDSR: "DSR Target Maksimum",
                ratioVisualHeader: "Visualisasi Batas DSR",
                ratioLegend_Safe: (currentDSR, dsrLimit) => `DSR Anda saat ini ${currentDSR}%. Maksimum yang diizinkan adalah ${dsrLimit}%. Anda memiliki ruang yang aman.`,
                ratioLegend_High: (currentDSR, dsrLimit) => `DSR Anda saat ini ${currentDSR}%. Maksimum yang diizinkan adalah ${dsrLimit}%. Ruang pinjaman Anda terbatas.`,
                ratioLegend_Over: (currentDSR, dsrLimit) => `PERINGATAN! DSR Anda saat ini (${currentDSR}%) SUDAH melebihi batas ideal (${dsrLimit}%). Anda tidak disarankan mengambil pinjaman baru.`,
                // RINGKASAN NARASI
                summaryTitle_Safe: "Status: Kapasitas Pinjaman Aman",
                summaryTitle_Limited: "Status: Kapasitas Pinjaman Terbatas",
                summaryTitle_Warning: "Peringatan: Tidak Disarankan Mengambil Pinjaman Baru",

                summaryText_Safe: (maxInstallment, maxLoanAmount, dsr) => `Anda berada dalam kondisi finansial yang baik untuk mengambil pinjaman baru. Maksimum cicilan bulanan baru yang aman adalah <strong>${maxInstallment}</strong>. Ini setara dengan pinjaman <strong>${maxLoanAmount}</strong> (dengan asumsi bunga dan jangka waktu yang Anda masukkan). DSR total Anda akan menjadi ${dsr}%.`,
                summaryText_Limited: (maxInstallment, maxLoanAmount, dsr) => `Anda memiliki kapasitas pinjaman, tetapi terbatas. Maksimum cicilan bulanan baru yang disarankan adalah <strong>${maxInstallment}</strong>, setara dengan pinjaman <strong>${maxLoanAmount}</strong>. Hati-hati agar total DSR tidak melebihi ${dsr}%.`,
                summaryText_Warning: (currentDSR, dsrLimit) => `Prioritas Anda BUKAN mengambil utang baru. DSR Anda saat ini (${currentDSR}%) sudah berada di tingkat yang dianggap RENTAN atau bahkan melebihi batas ideal (${dsrLimit}%). Anda harus fokus melunasi utang yang ada.`,

                errorInput: "Harap masukkan semua nilai yang valid dan pastikan Pendapatan Bersih > 0, DSR Limit > 0, dan Jangka Waktu > 0.",
                // KONTEN EDUKASI
                sectionHeader1: "Apa itu Debt Service Ratio (DSR)?",
                content1: "DSR adalah persentase total cicilan utang bulanan Anda dibagi dengan total pendapatan bulanan. Bank menggunakan rasio ini sebagai indikator kesehatan finansial Anda. Jika DSR Anda terlalu tinggi (misalnya, di atas 40%), bank akan menganggap Anda berisiko tinggi dan kemungkinan besar menolak permohonan pinjaman baru.",
                sectionHeader2: "Mengapa Batas DSR 35% Penting?",
                content2: "Batas 35% sering dianggap sebagai ambang batas aman. Ini berarti maksimal 35% dari pendapatan Anda dialokasikan untuk membayar utang. Jika rasio ini dilewati, kemampuan Anda untuk menabung, berinvestasi, dan menghadapi biaya tak terduga (dana darurat) akan terganggu secara serius, menempatkan Anda pada risiko gagal bayar yang lebih tinggi.",
                // FOOTER
                linkPrivacy: "Kebijakan Privasi",
                linkTerms: "Ketentuan Layanan",
                linkAbout: "Tentang Kami",
                linkContact: "Hubungi Kami",
                footerCopyright: "&copy; 2025 Digital Tools ID. Semua hak dilindungi."
            },
            en: {
                // UI TEXT
                appTitle: "Loan Affordability Calculator (Debt Payment Capacity)",
                backToCatalogText: "Back to Tools Catalog",
                headerTitle: "Loan Affordability Calculator",
                toolSubtitle: "It helps you avoid excessive debt and determine the amount of KPR, KKB, or KTA loan that is financially healthy. Use the Debt Service Ratio (DSR) to determine the safe maximum new installment amount and calculate the <strong>Maximum Loan</strong> you qualify for.",
                // LABELS INPUT
                sectionIncomeHeader: "1. Income & Current Debt Data",
                labelMonthlyIncome: "Total Net Monthly Income (After Tax)",
                labelExistingDebtPayment: "Total Current Monthly Debt Payment",
                descExistingDebtPayment: "Enter the total monthly payments for all existing debts (Car Loans, Personal Loans, etc.), NOT including rent/lease payments.",
                sectionNewLoanHeader: "2. Planned New Loan Details",
                labelLoanInterestRate: "Annual Loan Interest Rate (%)",
                labelLoanTermYears: "Loan Term (Years)",
                labelDSRLimit: "Ideal Debt Service Ratio (DSR) Limit (%)",
                descDSRLimit: "Banks typically set limits between 30% - 40%. 35% limit is very commonly used.",
                calculateButton: "Calculate Maximum Loan Capacity",
                // HASIL
                resultTitle: "Loan Capacity Analysis Result",
                metricsHeader: "Limitation Metrics",
                resultMaxMonthlyInstallment: "Maximum New Monthly Installment",
                resultMaxLoanAmount: "Maximum Loan Amount Affordable",
                resultCurrentDSR: "Your Current DSR",
                resultTargetDSR: "Maximum Target DSR",
                ratioVisualHeader: "DSR Limit Visualization",
                ratioLegend_Safe: (currentDSR, dsrLimit) => `Your current DSR is ${currentDSR}%. The maximum allowed is ${dsrLimit}%. You have safe borrowing room.`,
                ratioLegend_High: (currentDSR, dsrLimit) => `Your current DSR is ${currentDSR}%. The maximum allowed is ${dsrLimit}%. Your borrowing room is limited.`,
                ratioLegend_Over: (currentDSR, dsrLimit) => `WARNING! Your current DSR (${currentDSR}%) ALREADY exceeds the ideal limit (${dsrLimit}%). You are not advised to take out a new loan.`,
                // RINGKASAN NARASI
                summaryTitle_Safe: "Status: Safe Loan Capacity",
                summaryTitle_Limited: "Status: Limited Loan Capacity",
                summaryTitle_Warning: "Warning: New Loan Not Advised",

                summaryText_Safe: (maxInstallment, maxLoanAmount, dsr) => `You are in good financial standing to take out a new loan. The safe maximum new monthly installment is <strong>${maxInstallment}</strong>. This equates to a maximum loan of <strong>${maxLoanAmount}</strong> (based on the interest and term you entered). Your total DSR will be ${dsr}%.`,
                summaryText_Limited: (maxInstallment, maxLoanAmount, dsr) => `You have borrowing capacity, but it is limited. The recommended maximum new monthly installment is <strong>${maxInstallment}</strong>, equating to a maximum loan of <strong>${maxLoanAmount}</strong>. Be careful not to exceed the total DSR of ${dsr}%.`,
                summaryText_Warning: (currentDSR, dsrLimit) => `Your priority is NOT taking on new debt. Your current DSR (${currentDSR}%) is already at a VULNERABLE level or even exceeds the ideal limit (${dsrLimit}%). You must focus on paying off existing debt.`,

                errorInput: "Please enter all valid values and ensure Net Income > 0, DSR Limit > 0, and Loan Term > 0.",
                // KONTEN EDUKASI
                sectionHeader1: "What is the Debt Service Ratio (DSR)?",
                content1: "DSR is the percentage of your total monthly debt payments divided by your total monthly income. Banks use this ratio as an indicator of your financial health. If your DSR is too high (e.g., above 40%), banks will consider you high-risk and are likely to reject your new loan application.",
                sectionHeader2: "Why is the 35% DSR Limit Important?",
                content2: "The 35% limit is often considered the safe threshold. It means a maximum of 35% of your income is allocated to debt repayment. If this ratio is exceeded, your ability to save, invest, and handle unexpected costs (emergency fund) will be severely compromised, placing you at a higher risk of default.",
                // FOOTER
                linkPrivacy: "Privacy Policy",
                linkTerms: "Terms of Service",
                linkAbout: "About Us",
                linkContact: "Contact Us",
                footerCopyright: "&copy; 2025 Digital Tools ID. All rights reserved."
            }
        };

        let currentLang = 'id'; // Default Indonesia
        const resultBox = document.getElementById('resultBox');
        const errorAlert = document.getElementById('errorAlert');
        const errorText = document.getElementById('errorText');
        const ratioFill = document.getElementById('ratioFill');


        // **********************************************
        // FUNGSI UTILITAS (FORMAT ANGKA)
        // **********************************************

        function cleanInput(formattedValue) {
            if (typeof formattedValue !== 'string') return formattedValue;
            let cleaned = formattedValue.replace(/\D/g, '');
            return parseFloat(cleaned) || 0;
        }

        function formatNumber(num) {
            return num.toLocaleString(currentLang === 'id' ? 'id-ID' : 'en-US', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).replace('IDR', 'Rp');
        }

        function formatInput(inputElement) {
            let value = inputElement.value;
            let numericValue = value.replace(/[^0-9]/g, '');
            if (numericValue.length === 0) {
                inputElement.value = '';
                return;
            }
            let number = parseInt(numericValue, 10);
            // Format number without currency symbol for input field
            inputElement.value = number.toLocaleString(currentLang === 'id' ? 'id-ID' : 'en-US', {
                maximumFractionDigits: 0,
                minimumFractionDigits: 0
            });
        }

        // **********************************************
        // FUNGSI UTAMA: MENGHITUNG KAPASITAS CICILAN
        // **********************************************

        function calculateAffordability(event) {
            event.preventDefault();
            const t = translations[currentLang];

            // 1. Ambil Input
            const monthlyIncome = cleanInput(document.getElementById('monthlyIncome').value);
            const existingDebtPayment = cleanInput(document.getElementById('existingDebtPayment').value);
            const loanInterestRate = parseFloat(document.getElementById('loanInterestRate').value) / 100; // Annual
            const loanTermYears = parseFloat(document.getElementById('loanTermYears').value);
            const dsrLimit = parseFloat(document.getElementById('dsrLimit').value); // Percentage 

            // 2. Validasi
            if (monthlyIncome <= 0 || loanTermYears <= 0 || dsrLimit <= 0 || isNaN(monthlyIncome) || isNaN(existingDebtPayment) || isNaN(loanInterestRate) || isNaN(loanTermYears) || isNaN(dsrLimit)) {
                errorText.textContent = t.errorInput;
                errorAlert.classList.remove('hidden');
                resultBox.classList.remove('visible');
                return;
            }
            
            errorAlert.classList.add('hidden');

            // --- PERHITUNGAN DSR & KAPASITAS CICILAN ---
            
            // DSR Target Nominal
            const maxTotalPayment = monthlyIncome * (dsrLimit / 100);

            // Maksimum Cicilan Baru yang Diizinkan
            const maxNewInstallment = Math.max(0, maxTotalPayment - existingDebtPayment);
            const maxNewInstallmentFormatted = formatNumber(maxNewInstallment);

            // DSR Saat Ini (Tanpa Pinjaman Baru)
            const currentDSR = (existingDebtPayment / monthlyIncome) * 100;
            const currentDSRFormatted = currentDSR.toFixed(2) + '%';
            
            // DSR Total (Jika Pinjaman Baru diambil dengan batas maksimum)
            const finalDSR = ((existingDebtPayment + maxNewInstallment) / monthlyIncome) * 100;
            const finalDSRFormatted = finalDSR.toFixed(2) + '%';
            

            // --- PERHITUNGAN 2: PINJAMAN MAKSIMUM (PMT formula terbalik) ---
            let maxLoanAmount = 0;
            if (maxNewInstallment > 0) {
                // Formula Bunga Bulanan
                const rateMonthly = loanInterestRate / 12; 
                const nMonths = loanTermYears * 12;

                // Hitung nilai pinjaman (PV) dari cicilan (PMT)
                // PV = PMT * [ (1 - (1 + r)^-n) / r ]
                maxLoanAmount = maxNewInstallment * (1 - Math.pow(1 + rateMonthly, -nMonths)) / rateMonthly;
            }
            const maxLoanAmountFormatted = formatNumber(maxLoanAmount);


            // --- LOGIKA KESIMPULAN ---
            let summaryTitleKey;
            let summaryText;
            let ratioFillColor;
            let ratioLegendText;
            
            // Tentukan warna bilah berdasarkan DSR saat ini
            if (currentDSR > dsrLimit) {
                summaryTitleKey = 'summaryTitle_Warning';
                summaryText = t.summaryText_Warning(currentDSRFormatted, dsrLimit);
                ratioFillColor = '#e74c3c'; // Danger Color (Merah)
                ratioLegendText = t.ratioLegend_Over(currentDSRFormatted, dsrLimit);
            } else if (maxTotalPayment - existingDebtPayment < monthlyIncome * 0.10) { 
                // Jika ruang pinjaman baru kurang dari 10% pendapatan
                summaryTitleKey = 'summaryTitle_Limited';
                summaryText = t.summaryText_Limited(maxNewInstallmentFormatted, maxLoanAmountFormatted, finalDSRFormatted);
                ratioFillColor = '#f39c12'; // Warning Color (Kuning)
                ratioLegendText = t.ratioLegend_High(currentDSRFormatted, dsrLimit);
            } else {
                summaryTitleKey = 'summaryTitle_Safe';
                summaryText = t.summaryText_Safe(maxNewInstallmentFormatted, maxLoanAmountFormatted, finalDSRFormatted);
                ratioFillColor = '#27ae60'; // Success/Finance Color (Hijau)
                ratioLegendText = t.ratioLegend_Safe(currentDSRFormatted, dsrLimit);
            }

            // 3. Tampilkan Hasil
            
            // Tampilkan Ringkasan
            document.getElementById('summaryTitle').textContent = t[summaryTitleKey];
            document.getElementById('summaryText').innerHTML = summaryText;
            document.getElementById('resultSummaryText').className = `p-4 rounded-lg mb-4 bg-white border border-gray-200 ${summaryTitleKey === 'summaryTitle_Warning' ? 'border-danger-color/30' : 'border-finance-color/30'}`;

            // Tampilkan Metrik Kunci
            document.getElementById('maxMonthlyInstallmentResult').textContent = maxNewInstallmentFormatted;
            document.getElementById('maxLoanAmountResult').textContent = maxLoanAmountFormatted;
            document.getElementById('currentDSRResult').textContent = currentDSRFormatted;
            document.getElementById('targetDSRResult').textContent = dsrLimit + '%';

            // Tampilkan Visualisasi DSR
            // PERBAIKAN PENTING: Bilah isian harus menggunakan ratioFillColor yang telah ditentukan.
            const dsrRatioForVisual = Math.min(100, Math.max(0, (currentDSR / dsrLimit) * 100)); // Persentase DSR saat ini dari batas DSR
            ratioFill.style.width = `${dsrRatioForVisual}%`; 
            // Menggunakan warna HEX eksplisit atau variabel CSS yang dijamin ada
            ratioFill.style.backgroundColor = ratioFillColor; 
            
            document.getElementById('ratioLegend').textContent = ratioLegendText;

            resultBox.classList.add('visible');
        }


        // **********************************************
        // FUNGSI TRANSLATE & INISIALISASI
        // **********************************************

        function setLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            const languageSwitcher = document.getElementById('languageSwitcher');

            languageSwitcher.classList.remove('lang-en', 'lang-id');
            languageSwitcher.classList.add(`lang-${lang}`);
            document.documentElement.lang = lang;

            // Daftar ID elemen dan kunci terjemahan
            const elements = [
                'appTitle', 'backToCatalogText', 'headerTitle', 'toolSubtitle',
                'sectionIncomeHeader', 'labelMonthlyIncome', 'labelExistingDebtPayment', 'descExistingDebtPayment',
                'sectionNewLoanHeader', 'labelLoanInterestRate', 'labelLoanTermYears', 'labelDSRLimit', 'descDSRLimit',
                'calculateButton',
                'resultTitle', 'metricsHeader', 'resultMaxMonthlyInstallment', 'resultMaxLoanAmount', 'resultCurrentDSR', 'resultTargetDSR',
                'ratioVisualHeader',
                'sectionHeader1', 'content1', 'sectionHeader2', 'content2',
                'linkPrivacy', 'linkTerms', 'linkAbout', 'linkContact', 'footerCopyright'
            ];

            elements.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    if (id === 'toolSubtitle') {
                         el.innerHTML = t[id];
                    } else {
                        el.textContent = t[id];
                    }
                }
            });

            // Re-format input values based on new language settings
            ['monthlyIncome', 'existingDebtPayment'].forEach(id => {
                const input = document.getElementById(id);
                if (input.value) {
                    const cleanedValue = cleanInput(input.value);
                    input.value = cleanedValue.toLocaleString(lang === 'id' ? 'id-ID' : 'en-US', {
                        maximumFractionDigits: 0,
                        minimumFractionDigits: 0
                    });
                }
            });

            // Sembunyikan hasil saat ganti bahasa
            resultBox.classList.remove('visible');
            errorAlert.classList.add('hidden');
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Inisialisasi input dengan format ribuan
            ['monthlyIncome', 'existingDebtPayment'].forEach(id => {
                const input = document.getElementById(id);
                if (input.value) {
                    input.value = cleanInput(input.value).toLocaleString('id-ID', {
                        maximumFractionDigits: 0,
                        minimumFractionDigits: 0
                    });
                }
            });

            // Logika Deteksi Bahasa Awal
            let defaultLang = 'id';
            const browserLang = (navigator.language || navigator.userLanguage).toLowerCase();
            if (browserLang.startsWith('en')) {
                defaultLang = 'en';
            }
            setLanguage(defaultLang);
        });

        // Event listener untuk perubahan bahasa
        document.getElementById('languageSwitcher').addEventListener('click', (event) => {
            if (event.target.tagName === 'BUTTON') {
                const newLang = event.target.id === 'lang-en' ? 'en' : 'id';
                if (newLang !== currentLang) {
                    setLanguage(newLang);
                }
            }
        });

    </script>
</body>
</html>