<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="canonical" href="https://digitaltoolsid.github.io/kalkulator-npv-irr-bep/" />
    <title id="appTitle">Kalkulator Analisis Kelayakan Bisnis (BEP, NPV, IRR)</title>
    <link rel="alternate" hreflang="id" href="https://digitaltoolsid.github.io/kalkulator-npv-irr-bep/index.html" />
    <link rel="alternate" hreflang="en" href="https://digitaltoolsid.github.io/kalkulator-npv-irr-bep/index.html" />


    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Kode Google Analytic dan Adsense -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7M8E7QRYNY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-7M8E7QRYNY');
    </script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js?client=ca-pub-4885884866232864"
         crossorigin="anonymous"></script>
    
    <!-- Konfigurasi Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#2c3e50', 
                        'secondary': '#3498db', 
                        'primary-dark': '#1e3a8a', 
                        'finance-color': '#27ae60', // Hijau Keuangan
                        'success-color': '#27ae60',
                        'danger-color': '#e74c3c',
                        'warning-color': '#f39c12',
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Gaya Toggle Bahasa - Dibuat Fixed/Melayang */
        .lang-toggle-container { 
            position: fixed; /* FIXED */
            top: 15px;
            right: 15px;
            z-index: 2000; 
            display: inline-flex; 
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 9999px; 
            padding: 4px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); 
        }
        .lang-toggle-btn { 
            padding: 6px 14px; 
            font-size: 0.875rem; 
            font-weight: 600; 
            cursor: pointer; 
            z-index: 10; 
            color: #2c3e50; /* KOREKSI: Default warna teks yang tidak aktif diubah menjadi primary/biru tua */
            transition: color 0.3s ease; 
            position: relative; 
        }
        .lang-toggle-slider { 
            position: absolute; 
            top: 4px; 
            left: 4px; 
            height: calc(100% - 8px); 
            width: calc(50% - 4px); 
            background-color: #1e3a8a; 
            border-radius: 9999px; 
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            z-index: 5; 
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06); 
        }
        .lang-toggle-container.lang-en .lang-toggle-slider { transform: translateX(0%); }
        .lang-toggle-container.lang-id .lang-toggle-slider { transform: translateX(100%); }
        .lang-toggle-container.lang-en #lang-en { color: white; } /* Teks aktif harus putih di atas slider biru tua */
        .lang-toggle-container.lang-id #lang-id { color: white; } /* Teks aktif harus putih di atas slider biru tua */
        
        /* Gaya Hasil */
        .result-box { transition: all 0.5s ease-in-out; transform-origin: top center; opacity: 0; max-height: 0; overflow: hidden; }
        .result-box.visible { opacity: 1; max-height: 2500px; padding: 1.5rem; }

        /* Input khusus untuk Arus Kas */
        .cashflow-input {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .cashflow-input label {
            flex-shrink: 0;
            width: 4.5rem; /* Lebar label 'Tahun 1' */
            text-align: right;
            font-size: 0.875rem;
        }
        /* Gaya Tombol */
        .calculate-button {
            box-shadow: 0 4px #1e8449; /* Warna hijau yang lebih gelap */
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .calculate-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px #1e8449;
        }
        .calculate-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px #1e8449;
        }
        /* Style untuk referensi artikel */
        .article-reference {
            padding: 1.5rem;
            background-color: #ecfdf5; /* green-50 */
            border: 1px solid #a7f3d0; /* green-200 */
            border-radius: 0.75rem;
            margin-top: 2rem;
            text-align: center;
        }
        
        /* Gaya untuk deskripsi input baru */
        .input-description {
            font-size: 0.75rem; /* text-xs */
            color: #6b7280; /* text-gray-500 */
            margin-top: 0.25rem;
        }
    </style>
</head>

<!-- Body dengan kode pengaman -->
<body class="bg-gray-50 flex flex-col min-h-screen font-sans" oncontextmenu="return false;" oncopy="return false;" oncut="return false;">

    <!-- Header -->
    <header class="bg-primary-dark text-white py-4 shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <a href="../index.html" class="text-lg font-semibold tracking-tight text-gray-200 hover:text-white transition duration-150">
                &larr; <span id="backToCatalogText">Back to Tools Catalog</span>
            </a>
            <div id="languageSwitcher" class="lang-toggle-container lang-en">
                <div id="langToggleSlider" class. ="lang-toggle-slider"></div>
                <button id="lang-en" onclick="setLanguage('en')" class="lang-toggle-btn">EN</button>
                <button id="lang-id" onclick="setLanguage('id')" class="lang-toggle-btn">ID</button>
            </div>
            </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow p-4 sm:p-8 flex justify-center">
        <div class="w-full max-w-lg bg-white shadow-xl rounded-xl p-6 sm:p-8">
            
            <h1 id="headerTitle" class="text-3xl font-extrabold text-primary-dark mb-3">Kalkulator Analisis Kelayakan Bisnis</h1>
            <p id="toolSubtitle" class="text-base text-gray-700 font-medium mb-6">Hitung BEP, NPV, dan IRR secara simultan untuk mendapatkan <strong>Laporan Kesimpulan Manajemen</strong> (Executive Summary) yang jelas dan ringkas.</p>
            
            <!-- Formulir Tunggal Terintegrasi -->
            <form id="viabilityForm" onsubmit="calculateAllMetrics(event)" class="space-y-6">

                <!-- Input BEP -->
                <div class="border-b pb-4 border-gray-200">
                    <h2 class="text-xl font-bold text-finance-color mb-3" id="sectionBepHeader">1. Data Operasional (BEP)</h2>
                    <div class="space-y-4">
                        <div class="relative">
                            <label for="fixedCosts" class="block text-sm font-medium text-gray-700 mb-1" id="labelFixedCosts">Total Biaya Tetap (Per Tahun)</label>
                            <input type="text" id="fixedCosts" inputmode="numeric" oninput="formatInput(this)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-secondary focus:border-secondary" placeholder="Contoh: 100.000.000" value="100000000">
                        </div>
                        <div class="relative">
                            <label for="variableCost" class="block text-sm font-medium text-gray-700 mb-1" id="labelVariableCost">Biaya Variabel (Per Unit)</label>
                            <input type="text" id="variableCost" inputmode="numeric" oninput="formatInput(this)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-secondary focus:border-secondary" placeholder="Contoh: 50.000" value="50000">
                        </div>
                        <div class="relative">
                            <label for="salePrice" class="block text-sm font-medium text-gray-700 mb-1" id="labelSalePrice">Harga Jual (Per Unit)</label>
                            <input type="text" id="salePrice" inputmode="numeric" oninput="formatInput(this)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-secondary focus:border-secondary" placeholder="Contoh: 150.000" value="150000">
                        </div>
                    </div>
                </div>

                <!-- Input NPV/IRR (Arus Kas) -->
                <div class="border-b pb-4 border-gray-200">
                    <h2 class="text-xl font-bold text-finance-color mb-3" id="sectionNpvIrrHeader">2. Data Investasi & Proyeksi Arus Kas</h2>
                    
                    <div class="relative mb-4">
                        <label for="initialInvestment" class="block text-sm font-medium text-gray-700 mb-1" id="labelInitialInvestment">Investasi Awal (Tahun 0)</label>
                        <input type="text" id="initialInvestment" inputmode="numeric" oninput="formatInput(this)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-secondary focus:border-secondary" placeholder="Contoh: 500.000.000" value="500000000">
                    </div>

                    <div class="relative mb-4">
                        <label for="discountRate" class="block text-sm font-medium text-gray-700 mb-1" id="labelDiscountRate">Tingkat Diskonto (WACC) (% Per Tahun)</label>
                        <input type="number" id="discountRate" step="0.1" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-secondary focus:border-secondary" placeholder="Contoh: 10" value="10">
                        <p class="input-description" id="descDiscountRate">Persentase tingkat pengembalian minimum yang Anda harapkan dari investasi. Ini adalah tolok ukur (benchmark) risiko, juga dikenal sebagai Biaya Modal (WACC).</p>
                    </div>

                    <div class="space-y-2">
                        <p class="block text-sm font-medium text-gray-700" id="labelCashFlows">Proyeksi Arus Kas Bersih (Per Tahun)</p>
                        <div class="cashflow-input">
                            <label for="cf1" id="labelCF1">Tahun 1</label>
                            <input type="text" id="cf1" inputmode="numeric" oninput="formatInput(this)" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="150.000.000" value="150000000">
                        </div>
                        <div class="cashflow-input">
                            <label for="cf2" id="labelCF2">Tahun 2</label>
                            <input type="text" id="cf2" inputmode="numeric" oninput="formatInput(this)" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="200.000.000" value="200000000">
                        </div>
                        <div class="cashflow-input">
                            <label for="cf3" id="labelCF3">Tahun 3</label>
                            <input type="text" id="cf3" inputmode="numeric" oninput="formatInput(this)" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="250.000.000" value="250000000">
                        </div>
                        <div class="cashflow-input">
                            <label for="cf4" id="labelCF4">Tahun 4</label>
                            <input type="text" id="cf4" inputmode="numeric" oninput="formatInput(this)" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="300.000.000" value="300000000">
                        </div>
                        <div class="cashflow-input">
                            <label for="cf5" id="labelCF5">Tahun 5</label>
                            <input type="text" id="cf5" inputmode="numeric" oninput="formatInput(this)" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="350.000.000" value="350000000">
                        </div>
                    </div>
                </div>

                <button type="submit" id="calculateButton" class="calculate-button w-full bg-finance-color text-white font-semibold py-3 rounded-xl hover:bg-green-700 transition duration-300">
                    Hitung & Buat Laporan Manajemen
                </button>
            </form>

            <!-- Error Alert -->
            <div id="errorAlert" class="hidden mt-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
                <span id="errorText" class="block sm:inline"></span>
            </div>

            <!-- Result Box (Laporan Konsolidasi & Summary) -->
            <div id="resultBox" class="result-box mt-6 bg-secondary/5 border border-secondary/30 rounded-xl shadow-lg">
                
                <h3 id="resultTitle" class="text-2xl font-bold text-finance-color mb-4 border-b pb-2">Laporan Kesimpulan Manajemen</h3>
                
                <!-- EXECUTIVE SUMMARY -->
                <div id="executiveSummary" class="p-4 rounded-lg mb-4">
                    <p class="text-lg font-bold mb-2" id="summaryTitle"></p>
                    <p id="summaryText" class="text-gray-700 text-sm"></p>
                </div>

                <!-- METRIK KUNCI -->
                <h3 id="metricsHeader" class="text-xl font-bold text-primary mb-3 border-b pb-2">Metrik Kunci Kelayakan</h3>
                <div id="metricsContent" class="grid grid-cols-2 gap-4">
                    <!-- NPV -->
                    <div class="p-3 rounded-lg border border-gray-200">
                        <p class="text-sm text-gray-600" id="resultNPV">Net Present Value (NPV)</p>
                        <p class="text-2xl font-bold mt-1" id="npvResult">--</p>
                    </div>
                    <!-- IRR -->
                    <div class="p-3 rounded-lg border border-gray-200">
                        <p class="text-sm text-gray-600" id="resultIRR">Internal Rate of Return (IRR)</p>
                        <p class="text-2xl font-bold mt-1" id="irrResult">--</p>
                    </div>
                    <!-- BEP UNIT -->
                    <div class="p-3 rounded-lg border border-gray-200">
                        <p class="text-sm text-gray-600" id="resultBEPUnits">BEP (Unit)</p>
                        <p class="text-xl font-bold mt-1" id="bepUnitResult">--</p>
                    </div>
                    <!-- BEP REVENUE -->
                    <div class="p-3 rounded-lg border border-gray-200">
                        <p class="text-sm text-gray-600" id="resultBEPRevenue">BEP (Pendapatan)</p>
                        <p class="text-xl font-bold mt-1" id="bepRevenueResult">--</p>
                    </div>
                </div>
                
            </div>
            
            <!-- Konten Edukasi (Ringkasan Artikel) -->
            <section class="mt-8 pt-4 border-t border-gray-200 font-sans">
                <h2 id="sectionHeader1" class="text-xl font-bold text-gray-800 mb-3">Ringkasan Analisis Kelayakan</h2>
                <p id="content1" class="text-gray-600 text-sm leading-relaxed text-justify mb-4"></p>
                <h3 id="sectionHeader2" class="text-lg font-bold text-gray-800 mb-2"></h3>
                <p id="content2" class="text-gray-600 text-sm leading-relaxed text-justify mb-4"></p>
                <h3 id="sectionHeader3" class="text-lg font-bold text-gray-800 mb-2"></h3>
                <p id="content3" class="text-gray-600 text-sm leading-relaxed text-justify mb-4"></p>
                <h3 id="sectionHeader4" class="text-lg font-bold text-gray-800 mb-2"></h3>
                <p id="content4" class="text-gray-600 text-sm leading-relaxed text-justify mb-4"></p>
            </section>

            <!-- Link Artikel Terkait BARU -->
            <div class="article-reference">
                <p id="articleReferenceTitle" class="text-base font-semibold text-gray-800 mb-2">Perlu pemahaman lebih lanjut mengenai BEP, NPV, dan IRR?</p>
                <a href="../articles/analisis-titik-impas-bisnis.html" id="articleReferenceLink" class="text-finance-color hover:text-green-700 font-medium underline transition duration-150">Baca Artikel: Tiga Metrik Penting untuk Kelayakan Bisnis →</a>
            </div>

        </div>
    </main>
    
    <!-- Footer -->
    <footer class="mt-12 py-6 border-t border-gray-200 bg-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div id="footerLinks" class="flex flex-wrap justify-center space-x-4 sm:space-x-8 text-sm font-medium text-gray-600">
                <a href="../privacy-policy.html" id="linkPrivacy" class="hover:text-secondary">Privacy Policy</a>
                <span class="hidden sm:inline">|</span>
                <a href="../terms-of-service.html" id="linkTerms" class="hover:text-secondary">Terms of Service</a>
                <span class="hidden sm:inline">|</span>
                <a href="../about-us.html" id="linkAbout" class="hover:text-secondary">About Us</a>
                <span class="hidden sm:inline">|</span>
                <a href="../contact-us.html" id="linkContact" class="hover:text-secondary">Contact Us</a>
            </div>
            <div class="mt-6 text-center text-xs text-gray-500">
                <span id="footerCopyright">&copy; 2025 Digital Tools ID. All rights reserved. Developed by DTID Analytics.</span>
            </div>
        </div>
    </footer>
    
    <script>
        // **********************************************
        // LOGIKA KALKULATOR BEP, NPV, IRR - TERINTEGRASI
        // **********************************************

        const translations = {
            id: {
                appTitle: "Kalkulator Analisis Kelayakan Bisnis (BEP, NPV, IRR)",
                backToCatalogText: "Kembali ke Katalog Alat",
                headerTitle: "Kalkulator Analisis Kelayakan Bisnis",
                // KOREKSI: MENGHILANGKAN * DAN MENGGANTI DENGAN <em>
                toolSubtitle: "Apakah rencana bisnis Anda layak? Hitung BEP, NPV, dan IRR secara simultan. Misalnya, saat Anda ingin berinvestasi membuka toko dengan modal tertentu, gunakan kalkulator ini untuk memperoleh rekomendasi apakah rencana tersebut <em>layak secara finansial</em> atau tidak.",
                // LABELS INPUT
                sectionBepHeader: "1. Data Operasional (BEP)",
                labelFixedCosts: "Total Biaya Tetap (Per Tahun)",
                labelVariableCost: "Biaya Variabel (Per Unit)",
                labelSalePrice: "Harga Jual (Per Unit)",
                sectionNpvIrrHeader: "2. Data Investasi & Proyeksi Arus Kas",
                labelInitialInvestment: "Investasi Awal (Tahun 0)",
                labelDiscountRate: "Tingkat Diskonto (WACC) (% Per Tahun)",
                descDiscountRate: "Persentase tingkat pengembalian minimum yang Anda harapkan dari investasi. Ini adalah tolok ukur (benchmark) risiko, juga dikenal sebagai Biaya Modal (WACC).",
                labelCashFlows: "Proyeksi Arus Kas Bersih (Per Tahun)",
                labelCF1: "Tahun 1",
                labelCF2: "Tahun 2",
                labelCF3: "Tahun 3",
                labelCF4: "Tahun 4",
                labelCF5: "Tahun 5",
                calculateButton: "Hitung & Buat Laporan Manajemen",
                // HASIL
                resultTitle: "Laporan Kesimpulan Manajemen",
                metricsHeader: "Metrik Kunci Kelayakan",
                resultNPV: "Net Present Value (NPV)",
                resultIRR: "Internal Rate of Return (IRR)",
                resultBEPUnits: "BEP (Unit)",
                resultBEPRevenue: "BEP (Pendapatan)",
                resultDecision: "Keputusan",
                // RINGKASAN MANAJEMEN (Template Narasi)
                summaryTitle_Accept: "Status Proyek: Direkomendasikan DITERIMA",
                summaryTitle_Reject: "Status Proyek: Direkomendasikan DITOLAK/TINJAU ULANG",
                summaryTitle_Warning: "Status Proyek: DITERIMA DENGAN PERINGATAN RISIKO OPERASIONAL",

                summaryNPV_Accept: (npv, irr) => `Proyek ini <strong>layak secara finansial</strong>. Tingkat pengembalian internal (IRR) sebesar <strong>${irr}%</strong> melebihi biaya modal (tingkat diskonto). Secara nilai, proyek ini diperkirakan menambah nilai sebesar <strong>${npv}</strong> hari ini.`,
                summaryNPV_Reject: (npv, irr) => `Proyek ini <strong>tidak layak secara finansial</strong>. IRR proyek hanya <strong>${irr}%</strong>, di bawah biaya modal yang dibutuhkan. Diperkirakan proyek akan menghapus nilai sebesar <strong>${npv}</strong> hari ini.`,
                summaryBEP_LowRisk: (units, revenue) => `Dari sisi operasional, Titik Impas (BEP) berada di <strong>${units} unit</strong> atau <strong>${revenue}</strong>. Ini mengindikasikan <strong>margin keamanan yang baik</strong>, dan risiko operasional dianggap rendah.`,
                summaryBEP_HighRisk: (units, revenue) => `<strong>PERINGATAN RISIKO BEP TINGGI:</strong> Titik Impas (BEP) berada di <strong>${units} unit</strong> atau <strong>${revenue}</strong>. Angka ini mungkin <strong>terlalu tinggi</strong>, menuntut volume penjualan yang sulit dicapai dan meningkatkan risiko operasional secara signifikan.`,

                // ERRORS
                errorInput: "Harap masukkan semua nilai yang valid. Pastikan Harga Jual lebih tinggi dari Biaya Variabel, dan Arus Kas tidak semuanya negatif.",
                errorIRR: "Perhitungan IRR gagal. Pastikan Investasi Awal > 0 dan setidaknya satu Arus Kas Positif ada.",
                // KONTEN EDUKASI (Sama seperti Artikel)
                sectionHeader1: "Ringkasan Analisis Kelayakan",
                content1: "Menggunakan ketiga metrik ini secara bersamaan memberi Anda gambaran lengkap. BEP menilai keamanan operasional, sementara NPV dan IRR menilai profitabilitas jangka panjang dengan mempertimbangkan nilai waktu uang.",
                sectionHeader2: "Memahami BEP (Break-Even Point)",
                content2: "BEP adalah metrik keamanan Anda. Ini menunjukkan volume penjualan minimum yang diperlukan untuk menutupi semua biaya (tetap dan variabel). Menjual di atas BEP berarti untung, menjual di bawahnya berarti rugi.",
                sectionHeader3: "Memahami NPV (Net Present Value)",
                content3: "NPV adalah metrik nilai. Ia menghitung nilai hari ini dari semua keuntungan masa depan, dikurangi investasi awal Anda. Jika NPV positif, proyek tersebut 'Layak' karena menambah nilai bagi Anda.",
                sectionHeader4: "Memahami IRR (Internal Rate of Return)",
                content4: "IRR adalah metrik efisiensi. Ini adalah tingkat pengembalian (profit) tahunan yang dihasilkan oleh investasi Anda. Anda harus membandingkan IRR ini dengan 'Tingkat Diskonto' atau biaya modal Anda (misalnya, bunga pinjaman bank) untuk melihat apakah investasi itu sepadan.",
                // REFERENSI ARTIKEL
                articleRefTitle: "Perlu pemahaman lebih lanjut mengenai BEP, NPV, dan IRR?",
                articleRefLinkText: "Baca Artikel: Tiga Metrik Penting untuk Kelayakan Bisnis →",
                articleRefLinkPath: "../articles/analisis-titik-impas-bisnis.html",
                // FOOTER
                linkPrivacy: "Kebijakan Privasi",
                linkTerms: "Ketentuan Layanan",
                linkAbout: "Tentang Kami",
                linkContact: "Hubungi Kami",
                footerCopyright: "&copy; 2025 Digital Tools ID. Semua hak dilindungi. Dikembangkan oleh DTID Analytics."
            },
            en: {
                appTitle: "Business Viability Analyzer (BEP, NPV, IRR)",
                backToCatalogText: "Back to Tools Catalog",
                headerTitle: "Business Viability Analyzer",
                // KOREKSI: MENGHILANGKAN * DAN MENGGANTI DENGAN <em>
                toolSubtitle: "Is your business plan viable? Calculate BEP, NPV, and IRR simultaneously. For example, when you want to invest in opening a store with certain initial capital, use this calculator to get a recommendation on whether the plan is <em>financially feasible</em> or not.",
                // LABELS INPUT
                sectionBepHeader: "1. Operational Data (BEP)",
                labelFixedCosts: "Total Fixed Costs (Per Year)",
                labelVariableCost: "Variable Cost (Per Unit)",
                labelSalePrice: "Sale Price (Per Unit)",
                sectionNpvIrrHeader: "2. Investment & Cash Flow Projection",
                labelInitialInvestment: "Initial Investment (Year 0)",
                labelDiscountRate: "Discount Rate (WACC) (% Per Year)",
                descDiscountRate: "The minimum rate of return you expect from the investment. This is the risk benchmark, also known as the Cost of Capital (WACC).",
                labelCashFlows: "Projected Net Cash Flows (Per Year)",
                labelCF1: "Year 1",
                labelCF2: "Year 2",
                labelCF3: "Year 3",
                labelCF4: "Year 4",
                labelCF5: "Year 5",
                calculateButton: "Calculate & Generate Management Report",
                // HASIL
                resultTitle: "Executive Summary Report",
                metricsHeader: "Key Viability Metrics",
                resultNPV: "Net Present Value (NPV)",
                resultIRR: "Internal Rate of Return (IRR)",
                resultBEPUnits: "BEP (Units)",
                resultBEPRevenue: "BEP (Revenue)",
                resultDecision: "Decision",
                // RINGKASAN MANAJEMEN (Template Narasi)
                summaryTitle_Accept: "Project Status: Recommended ACCEPT",
                summaryTitle_Reject: "Project Status: Recommended REJECT/REVIEW",
                summaryTitle_Warning: "Project Status: ACCEPT WITH OPERATIONAL RISK WARNING",

                summaryNPV_Accept: (npv, irr) => `The project is <strong>financially viable</strong>. The internal rate of return (IRR) of <strong>${irr}%</strong> exceeds the cost of capital (discount rate). In terms of value, the project is expected to add <strong>${npv}</strong> in value today.`,
                summaryNPV_Reject: (npv, irr) => `The project is <strong>not financially viable</strong>. The project's IRR is only <strong>${irr}%</strong>, which is below the required cost of capital. The project is expected to lose <strong>${npv}</strong> in value today.`,
                summaryBEP_LowRisk: (units, revenue) => `From an operational standpoint, the Break-Even Point (BEP) is at <strong>${units} units</strong> or <strong>${revenue}</strong> in revenue. This indicates a <strong>good safety margin</strong>, and operational risk is considered low.`,
                summaryBEP_HighRisk: (units, revenue) => `<strong>HIGH BEP RISK WARNING:</strong> The Break-Even Point (BEP) is at <strong>${units} units</strong> or <strong>${revenue}</strong> in revenue. This figure may be <strong>too high</strong>, demanding a sales volume that is difficult to achieve and significantly increasing operational risk.`,

                // ERRORS
                errorInput: "Please enter all valid values. Ensure Sale Price is higher than Variable Cost, and Cash Flows are not all negative.",
                errorIRR: "IRR calculation failed. Ensure Initial Investment > 0 and at least one Positive Cash Flow exists.",
                // KONTEN EDUKASI (Sama seperti Artikel)
                sectionHeader1: "Viability Analysis Summary",
                content1: "Using these three metrics together gives you a complete picture. BEP assesses operational safety, while NPV and IRR assess long-term profitability by considering the time value of money.",
                sectionHeader2: "Understanding BEP (Break-Even Point)",
                content2: "BEP is your safety metric. It shows the minimum sales volume needed to cover all costs (fixed and variable). Selling above BEP means profit; selling below it means a loss.",
                sectionHeader3: "Understanding NPV (Net Present Value)",
                content3: "NPV is the value metric. It calculates the present-day value of all future profits, minus your initial investment. If NPV is positive, the project is 'Accepted' as it adds value to you.",
                sectionHeader4: "Understanding IRR (Internal Rate of Return)",
                content4: "IRR is the efficiency metric. It is the annual rate of return (profit) generated by your investment. You must compare this IRR to your 'Discount Rate' or cost of capital (e.g., bank loan interest) to see if the investment is worthwhile.",
                // REFERENSI ARTIKEL
                articleRefTitle: "Need a deeper understanding of BEP, NPV, and IRR?",
                articleRefLinkText: "Read Article: Three Essential Metrics for Business Viability →",
                articleRefLinkPath: "../articles/analisis-titik-impas-bisnis.html",
                // FOOTER
                linkPrivacy: "Privacy Policy",
                linkTerms: "Terms of Service",
                linkAbout: "About Us",
                linkContact: "Contact Us",
                footerCopyright: "&copy; 2025 Digital Tools ID. All rights reserved. Developed by DTID Analytics."
            }
        };

        let currentLang = 'en'; // Default
        const resultBox = document.getElementById('resultBox');
        const resultTitle = document.getElementById('resultTitle');
        const executiveSummary = document.getElementById('executiveSummary');
        const errorAlert = document.getElementById('errorAlert');
        const errorText = document.getElementById('errorText');

        // **********************************************
        // FUNGSI UTILITAS (FORMAT ANGKA)
        // **********************************************

        // Membersihkan format (titik/koma) sebelum menghitung
        function cleanInput(formattedValue) {
            if (typeof formattedValue !== 'string') return formattedValue;
            let cleaned = formattedValue.replace(/\D/g, '');
            return parseFloat(cleaned) || 0;
        }

        // Memformat angka dengan pemisah ribuan (tanpa desimal)
        function formatNumber(num) {
            return num.toLocaleString(currentLang === 'id' ? 'id-ID' : 'en-US', {
                maximumFractionDigits: 0,
                minimumFractionDigits: 0
            });
        }
        
        // Memformat angka dengan 2 desimal (untuk Unit/IRR)
        function formatDecimal(num) {
            return num.toLocaleString(currentLang === 'id' ? 'id-ID' : 'en-US', {
                maximumFractionDigits: 2,
                minimumFractionDigits: 2
            });
        }

        // Memformat input saat pengguna mengetik
        function formatInput(inputElement) {
            let value = inputElement.value;
            let numericValue = value.replace(/[^0-9]/g, '');
            if (numericValue.length === 0) {
                inputElement.value = '';
                return;
            }
            let number = parseInt(numericValue, 10);
            inputElement.value = formatNumber(number);
        }

        // **********************************************
        // FUNGSI UTAMA: MENGHITUNG KETIGA METRIK
        // **********************************************
        
        // Fungsi bantu untuk menghitung NPV (digunakan oleh IRR)
        function calculateNPV_for_IRR(rate, cfs) {
            let npv = cfs[0]; // cfs[0] adalah investasi awal (negatif)
            for (let i = 1; i < cfs.length; i++) {
                npv += cfs[i] / Math.pow(1 + rate, i);
            }
            return npv;
        }

        // Fungsi utama yang dipanggil oleh tombol hitung
        function calculateAllMetrics(event) {
            event.preventDefault();
            const t = translations[currentLang];
            
            // --- Input BEP ---
            const fixedCosts = cleanInput(document.getElementById('fixedCosts').value);
            const variableCost = cleanInput(document.getElementById('variableCost').value);
            const salePrice = cleanInput(document.getElementById('salePrice').value);

            // --- Input NPV/IRR ---
            const initialInvestment = cleanInput(document.getElementById('initialInvestment').value);
            const discountRate = parseFloat(document.getElementById('discountRate').value) / 100;
            const cashFlowsInputs = [
                cleanInput(document.getElementById('cf1').value),
                cleanInput(document.getElementById('cf2').value),
                cleanInput(document.getElementById('cf3').value),
                cleanInput(document.getElementById('cf4').value),
                cleanInput(document.getElementById('cf5').value)
            ];

            // 1. Validasi Input Dasar
            if (fixedCosts <= 0 || variableCost < 0 || salePrice <= 0 || initialInvestment <= 0 || discountRate <= 0 || cashFlowsInputs.some(cf => isNaN(cf))) {
                errorText.textContent = t.errorInput;
                errorAlert.classList.remove('hidden');
                resultBox.classList.remove('visible');
                return;
            }

            const contributionMargin = salePrice - variableCost;
            if (contributionMargin <= 0 || cashFlowsInputs.every(cf => cf <= 0)) {
                errorText.textContent = t.errorInput; // Menggunakan errorInput untuk validasi kompleks
                errorAlert.classList.remove('hidden');
                resultBox.classList.remove('visible');
                return;
            }
            
            errorAlert.classList.add('hidden');
            
            // ==========================================
            // --- PERHITUNGAN 1: BEP ---
            // ==========================================
            const bepUnits = fixedCosts / contributionMargin;
            const bepRevenue = bepUnits * salePrice;
            const bepUnitFormatted = formatDecimal(bepUnits);
            const bepRevenueFormatted = formatNumber(bepRevenue);
            
            // Asumsi Risk (Jika BEP Unit sangat besar, katakanlah > 200% dari tahun CF terendah, anggap High Risk)
            // Menggunakan CF terendah sebagai proxy untuk volume/kapasitas penjualan tahunan yang aman (safety margin)
            const minCashFlow = Math.min(...cashFlowsInputs.filter(cf => cf > 0));
            // Proxy untuk penjualan tahunan (gunakan CF terendah / Harga Jual)
            const proxyAnnualSaleUnits = minCashFlow / salePrice;
            const isHighBEPRisk = bepUnits > (proxyAnnualSaleUnits * 2); 

            
            // ==========================================
            // --- PERHITUNGAN 2 & 3: NPV & IRR ---
            // ==========================================
            
            // Hitung NPV
            let totalPV = 0;
            cashFlowsInputs.forEach((cf, index) => {
                totalPV += cf / Math.pow(1 + discountRate, index + 1);
            });
            const npv = totalPV - initialInvestment;
            const npvFormatted = formatNumber(npv);
            
            // Hitung IRR (Menggunakan Metode Iterasi)
            const cfs_irr = [-initialInvestment, ...cashFlowsInputs];
            
            let irr = 0;
            let guess = discountRate;
            let lowRate = 0;
            let highRate = 1; // 100%
            const maxIterations = 100;
            const precision = 0.0001;
            let iterations = 0;

            if (calculateNPV_for_IRR(lowRate, cfs_irr) * calculateNPV_for_IRR(highRate, cfs_irr) > 0) {
                 irr = 0; 
            } else {
                lowRate = 0; 
                highRate = 1;
                while (iterations < maxIterations) {
                    guess = (lowRate + highRate) / 2;
                    let npv_val = calculateNPV_for_IRR(guess, cfs_irr);

                    if (Math.abs(npv_val) < precision) {
                        irr = guess;
                        break;
                    }
                    
                    if (npv_val > 0) {
                        lowRate = guess;
                    } else {
                        highRate = guess;
                    }
                    iterations++;
                }
            }
            
            const irrPercent = irr * 100;
            const irrFormatted = formatDecimal(irrPercent);
            
            // ==========================================
            // --- KESIMPULAN MANAJEMEN ---
            // ==========================================
            let summaryTitleKey;
            let summaryText;
            let summaryBgClass;
            
            // Keputusan Finansial (NPV/IRR)
            if (npv > 0 && irr > discountRate) {
                summaryTitleKey = 'summaryTitle_Accept';
                summaryBgClass = 'bg-success-color/10 border-success-color/30';
                summaryText = t.summaryNPV_Accept(npvFormatted, irrFormatted);
            } else {
                summaryTitleKey = 'summaryTitle_Reject';
                summaryBgClass = 'bg-danger-color/10 border-danger-color/30';
                summaryText = t.summaryNPV_Reject(npvFormatted, irrFormatted);
            }
            
            // Keputusan Operasional (BEP)
            let bepSummaryText;
            if (isHighBEPRisk) {
                bepSummaryText = t.summaryBEP_HighRisk(bepUnitFormatted, bepRevenueFormatted);
                // Jika Diterima tapi BEP High Risk, turunkan ke status Warning
                if (summaryTitleKey === 'summaryTitle_Accept') {
                    summaryTitleKey = 'summaryTitle_Warning';
                    summaryBgClass = 'bg-warning-color/10 border-warning-color/30';
                }
            } else {
                bepSummaryText = t.summaryBEP_LowRisk(bepUnitFormatted, bepRevenueFormatted);
            }
            
            // Gabungkan Teks Laporan
            const finalSummary = summaryText + '<br><br><strong>Analisis Operasional (BEP):</strong> ' + bepSummaryText;

            // 4. Tampilkan Hasil
            document.getElementById('summaryTitle').textContent = t[summaryTitleKey];
            document.getElementById('summaryText').innerHTML = finalSummary;
            executiveSummary.className = `p-4 rounded-lg mb-4 border ${summaryBgClass}`;
            
            // Tampilkan Metrik Kunci
            document.getElementById('npvResult').textContent = npvFormatted;
            document.getElementById('npvResult').className = `text-2xl font-bold mt-1 ${npv > 0 ? 'text-success-color' : 'text-danger-color'}`;

            document.getElementById('irrResult').textContent = irrFormatted + '%';
            document.getElementById('irrResult').className = `text-2xl font-bold mt-1 ${irr > discountRate ? 'text-success-color' : 'text-danger-color'}`;

            document.getElementById('bepUnitResult').textContent = bepUnitFormatted;
            document.getElementById('bepRevenueResult').textContent = bepRevenueFormatted;

            resultBox.classList.add('visible');
        }


        // **********************************************
        // FUNGSI TRANSLATE & INISIALISASI
        // **********************************************

        function setLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            const languageSwitcher = document.getElementById('languageSwitcher');
            const articleRefLink = document.getElementById('articleReferenceLink');
            const articleRefTitle = document.getElementById('articleReferenceTitle');
            const descDiscountRate = document.getElementById('descDiscountRate');

            languageSwitcher.classList.remove('lang-en', 'lang-id');
            languageSwitcher.classList.add(`lang-${lang}`);
            document.documentElement.lang = lang; 

            // Daftar ID elemen dan kunci terjemahan
            const elements = [
                'appTitle', 'backToCatalogText', 'headerTitle', 'toolSubtitle', 
                'sectionBepHeader', 'labelFixedCosts', 'labelVariableCost', 'labelSalePrice',
                'sectionNpvIrrHeader', 'labelInitialInvestment', 'labelDiscountRate', 'labelCashFlows',
                'labelCF1', 'labelCF2', 'labelCF3', 'labelCF4', 'labelCF5', 'calculateButton',
                'resultTitle', 'metricsHeader', 'resultNPV', 'resultIRR', 'resultBEPUnits', 'resultBEPRevenue',
                'sectionHeader1', 'content1', 'sectionHeader2', 'content2', 'sectionHeader3', 'content3', 'sectionHeader4', 'content4',
                'linkPrivacy', 'linkTerms', 'linkAbout', 'linkContact', 'footerCopyright'
            ];

            elements.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    if (['content1', 'content2', 'content3', 'content4', 'toolSubtitle', 'footerCopyright'].includes(id)) {
                        el.innerHTML = t[id];
                    } else {
                        el.textContent = t[id];
                    }
                }
            });
            
            // Update elemen tautan artikel
            articleRefTitle.textContent = t.articleRefTitle;
            articleRefLink.textContent = t.articleRefLinkText;
            articleRefLink.href = t.articleRefLinkPath;
            
            // Update deskripsi WACC
            descDiscountRate.textContent = t.descDiscountRate;

            resultBox.classList.remove('visible');
            errorAlert.classList.add('hidden');
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Inisialisasi input dengan format ribuan
            ['fixedCosts', 'variableCost', 'salePrice', 'initialInvestment', 'cf1', 'cf2', 'cf3', 'cf4', 'cf5'].forEach(id => {
                const input = document.getElementById(id);
                if (input.value) {
                    input.value = formatNumber(cleanInput(input.value));
                }
            });
            
            // Logika Deteksi Bahasa Awal
            let defaultLang = 'en'; 
            const browserLang = (navigator.language || navigator.userLanguage).toLowerCase();
            if (browserLang.startsWith('id')) {
                defaultLang = 'id';
            }
            setLanguage(defaultLang); 
        });

        // Event listener untuk perubahan bahasa
        document.getElementById('languageSwitcher').addEventListener('click', (event) => {
            if (event.target.tagName === 'BUTTON') {
                const newLang = event.target.id === 'lang-en' ? 'en' : 'id';
                if (newLang !== currentLang) {
                    setLanguage(newLang);
                }
            }
        });

    </script>
</body>
</html>