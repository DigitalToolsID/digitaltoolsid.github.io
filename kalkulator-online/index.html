<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="canonical" href="https://digitaltoolsid.github.io/kalkulator-online/" />
    
    <meta name="description" content="Online Business Calculator. Features receipt printing (PDF), calculation history, and number-to-words conversion (Rupiah/Dollar). Ideal for small business owners." />
    <meta name="keywords" content="Online Business Calculator, Receipt Calculator, PDF Receipt Generator, Number to Words, Kalkulator Bisnis Online, Kalkulator Dagang, Cetak Struk PDF, Terbilang Rupiah, Kalkulator Kasir, Kalkulator Warung, how to print receipt from calculator, cara hitung total belanja, aplikasi kasir sederhana">
 
    <link rel="icon" href="data:,">

    <title id="appTitle">Kalkulator Dagang Online, Cetak Struk PDF & Terbilang Rupiah - Digital Tools ID</title>
    
    <link rel="alternate" hreflang="id" href="https://digitaltoolsid.github.io/kalkulator-online/index.html" />
    <link rel="alternate" hreflang="en" href="https://digitaltoolsid.github.io/kalkulator-online/index.html" />

    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../output.css"> 
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7M8E7QRYNY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-7M8E7QRYNY');
    </script>
    <style>
        /* CSS LOKAL */
        body { 
            background-color: #f4f4f4;
            -webkit-tap-highlight-color: transparent; 
        }

        /* Layout Utama Flex */
        .calc-content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 24px; 
            width: 100%;
        }

        /* --- PENGATURAN LEBAR RESPONSIF --- */
        
        /* 1. DEFAULT (MOBILE FIRST): Lebar Penuh agar enak di HP */
        .calc-ui-wrapper,
        .receipt-paper,
        #install-card {
            width: 100%; 
        }

        /* 2. DESKTOP ONLY: Hard Lock Container 50% & Box Kalkulator 70% */
        @media (min-width: 1024px) {
            .layout-article-fixed {
                width: 50% !important;
                max-width: 50% !important;
                min-width: 50% !important;
                margin-left: auto;
                margin-right: auto;
            }

            /* Di Desktop, box kalkulator & history jadi 70% dari container konten */
            .calc-ui-wrapper,
            .receipt-paper,
            #install-card {
                width: 70% !important; 
            }
        }
        /* ---------------------------------- */

        /* Wrapper Kalkulator UI */
        .calc-ui-wrapper {
            background-color: #e5e7eb; 
            padding: 16px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid #ccc;
        }

        /* Layar Kalkulator */
        #display {
            font-family: 'Courier New', monospace;
            letter-spacing: 1px;
            border: 3px solid #888;
            overflow-x: auto; 
            white-space: nowrap; 
        }
        
        /* Tombol Kalkulator */
        button.calc-btn {
            height: 60px;
            font-size: 1.25rem;
            border-radius: 12px;
            transition: all 0.1s;
            box-shadow: 0 4px 0 #374151;
            font-weight: 600;
            color: white;
        }
        button.calc-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #374151;
        }
        
        /* Warna Tombol */
        .btn-red { background-color: #ef4444 !important; box-shadow: 0 4px 0 #b91c1c !important;} 
        .btn-gray-dark { background-color: #374151 !important; }
        .btn-yellow { background-color: #f59e0b !important; box-shadow: 0 4px 0 #d97706 !important;} 
        .btn-blue { background-color: #3b82f6 !important; box-shadow: 0 4px 0 #1d4ed8 !important;} 
        .btn-green { background-color: #10b981 !important; box-shadow: 0 4px 0 #047857 !important;} 

        /* Kertas Struk (History) Style */
        .receipt-paper {
            background-color: #fff;
            border: 1px solid #e5e7eb;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }

        @keyframes slideInUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        #ios-modal > div, #non-ios-modal > div { animation: slideInUp 0.3s ease-out; }
        
        #ios-modal, #non-ios-modal {
            z-index: 1000; 
        }
        #non-ios-modal {
            align-items: center !important; 
        }
        
        #related-tools-section {
            margin-bottom: 0 !important;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen">

    <script>window.headerCategory = 'productivity';</script>
    <div id="global-header-container"></div>

    <main class="flex-grow p-4 sm:p-8 flex flex-col items-center">
        <div class="w-full layout-article-fixed bg-white shadow-xl rounded-xl p-6 sm:p-8">
        
            <div class="calc-content-wrapper">
                
                <div class="text-center w-full">
                    <h1 id="headerTitle" class="text-3xl font-extrabold text-gray-800 mb-2" data-id="Kalkulator Bisnis Online" data-en="Online Business Calculator">Online Business Calculator</h1>
      
                   <p id="appDescription" class="text-sm text-gray-600 mb-4 px-1 text-justify leading-relaxed" 
                      data-id="Alat hitung standar yang diperkaya fitur riwayat, narasi terbilang rupiah, dan dapat mencetak struk sederhana dalam format PDF."
                      data-en="A standard calculator enhanced with history, spell-out feature, and the ability to print simple receipts in PDF format.">
                        A standard calculator enhanced with history, spell-out feature, and the ability to print simple receipts in PDF format.
                   </p>
                </div>

                <div class="calc-ui-wrapper">
                    <div class="mb-4">
                        <input type="text" id="display" readonly value="0" class="w-full h-16 bg-[#D1D5DB] text-right text-3xl font-bold text-gray-900 p-3 rounded-xl focus:outline-none overflow-hidden placeholder-gray-500" style="border: 3px solid #888;">
                       <div id="terbilang" class="bg-gray-700 text-yellow-400 text-xs text-right p-2 mt-1 rounded italic min-h-[30px] leading-tight" data-id="Nol Rupiah" data-en="Zero Dollar">
                            Zero Dollar
                        </div>
                    </div>

                    <div id="keypad" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                        <button class="calc-btn btn-red" onclick="clearDisplay()">C</button>
                        <button class="calc-btn btn-gray-dark" onclick="deleteLast()">‚å´</button>
                        <button class="calc-btn btn-yellow" onclick="appendToDisplay('/')">√∑</button>
                        <button class="calc-btn btn-yellow" onclick="appendToDisplay('*')">√ó</button>

                        <button class="calc-btn btn-gray-dark" onclick="appendToDisplay('7')">7</button>
                        <button class="calc-btn btn-gray-dark" onclick="appendToDisplay('8')">8</button>
                        <button class="calc-btn btn-gray-dark" onclick="appendToDisplay('9')">9</button>
                        <button class="calc-btn btn-yellow" onclick="appendToDisplay('-')">-</button>

                        <button class="calc-btn btn-gray-dark" onclick="appendToDisplay('4')">4</button>
                        <button class="calc-btn btn-gray-dark" onclick="appendToDisplay('5')">5</button>
                        <button class="calc-btn btn-gray-dark" onclick="appendToDisplay('6')">6</button>
                        <button class="calc-btn btn-yellow" onclick="appendToDisplay('+')">+</button>

                        <button class="calc-btn btn-gray-dark" onclick="appendToDisplay('1')">1</button>
                        <button class="calc-btn btn-gray-dark" onclick="appendToDisplay('2')">2</button>
                        <button class="calc-btn btn-gray-dark" onclick="appendToDisplay('3')">3</button>
                        <button class="calc-btn btn-blue" onclick="copyResult()">üìã COPY</button>

                        <button class="calc-btn btn-gray-dark" style="grid-column: span 2;" onclick="appendToDisplay('0')">0</button>
                        <button class="calc-btn btn-gray-dark" onclick="appendToDisplay('.')">.</button>
                        <button class="calc-btn btn-green" onclick="calculate()">=</button>
                    </div>
                    
                    <button onclick="printCurrentPDF()" class="mt-4 w-full bg-white text-gray-800 font-bold py-3 rounded-xl hover:bg-gray-200 transition flex items-center justify-center gap-2" data-id="Cetak / Simpan PDF (Hitungan Ini)" data-en="Print / Save PDF (This Calculation)">
                        <span>üñ®Ô∏è</span> Print / Save PDF (This Calculation)
                    </button>
                </div>
                
                <div class="receipt-paper rounded-xl flex flex-col h-[500px]">
                    <div class="bg-gray-100 p-3 rounded-t-xl border-b border-gray-200 flex justify-between items-center">
                        <h3 class="font-mono font-bold text-gray-700 flex items-center gap-2" id="labelHistoryHeader" data-id="RIWAYAT" data-en="HISTORY">
                            <span>üßæ</span> HISTORY
                        </h3>
                        <button onclick="clearHistory()" class="text-xs text-red-500 hover:text-red-700 font-bold uppercase tracking-wide border border-red-200 px-2 py-1 rounded bg-white" data-id="Hapus" data-en="Clear">
                            Clear
                        </button>
                    </div>
      
                    <div id="history-list" class="flex-grow overflow-y-auto p-4 space-y-4 custom-scrollbar bg-white font-mono text-sm">
                    </div>
                </div>

                <div id="install-card" class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded shadow-sm">
                    <div class="flex justify-between items-start">
                        <div class="flex gap-3">
                            <div class="text-2xl">üì±</div>
                            <div>
                                <h3 class="font-bold text-gray-800 text-sm" id="labelInstallTitle" data-id="Simpan URL di Home Screen" data-en="Save URL to Home Screen">Save URL to Home Screen</h3>
                                <p class="text-xs text-gray-600 mt-1 leading-relaxed" id="labelInstallDesc" 
                                   data-id="Untuk memudahkan penggunaan di kemudian hari, simpan URL alat ini.<br>Manfaat: <strong>Gratis, Tanpa download, Tanpa memori HP, Aman.</strong>" 
                                   data-en="To ensure easy reuse, save this tool's URL.<br>Benefits: <strong>Free, No download, No phone memory usage, Safe.</strong>">
                                    To ensure easy reuse, save this tool's URL.<br>Benefits: <strong>Free, No download, No phone memory usage, Safe.</strong>
                                </p>
        
                                <button id="installBtn" onclick="showInstallInstructions()" class="mt-2 bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold py-2 px-4 rounded transition" data-id="Petunjuk Simpan ke Layar Utama" data-en="Instructions to Save to Home Screen">
                                    Instructions to Save to Home Screen
                                </button>
                            </div>
                        </div>
                        <button onclick="document.getElementById('install-card').classList.add('hidden')" class="text-gray-400 hover:text-gray-600">&times;</button>
                    </div>
                </div>

                <section id="related-tools-section" class="w-full mt-8 pt-4 border-t border-gray-200">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 text-center" data-en="Most Popular Tools" data-id="Alat Terpopuler Lainnya">Most Popular Tools</h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
                        
                        <div class="p-4 rounded-xl border border-gray-200 bg-gray-50">
                           <h3 class="font-bold mb-2 text-green-600" data-en="Finance" data-id="Keuangan">Finance</h3>
                            <ul class="space-y-1 text-sm text-gray-600">
                                <li><a href="../kalkulator-bunga-majemuk/index.html" class="hover:underline" data-en="Compound Interest" data-id="Bunga Majemuk">Compound Interest</a></li>
                                <li><a href="../kalkulator-pinjaman-multi-tujuan/index.html" class="hover:underline" data-en="Loan/KPR Calculator" data-id="Kalkulator Pinjaman (KPR)">Loan/KPR Calculator</a></li>
                            </ul>
                        </div>

                        <div class="p-4 rounded-xl border border-gray-200 bg-gray-50">
                           <h3 class="font-bold mb-2 text-red-600" data-en="Health" data-id="Kesehatan">Health</h3>
                            <ul class="space-y-1 text-sm text-gray-600">
                                <li><a href="../kalkulator-bmi/index.html" class="hover:underline" data-en="BMI Calculator" data-id="Kalkulator BMI">BMI Calculator</a></li>
                                <li><a href="../kalkulator-bmr/index.html" class="hover:underline" data-en="BMR Calculator" data-id="Kalkulator BMR">BMR Calculator</a></li>
                            </ul>
                        </div>

                        <div class="p-4 rounded-xl border border-gray-200 bg-gray-50">
                            <h3 class="font-bold mb-2 text-purple-600" data-en="Productivity" data-id="Produktivitas">Productivity</h3>
                            <ul class="space-y-1 text-sm text-gray-600">
                                <li><a href="../kalkulator-konversi-satuan/index.html" class="hover:underline" data-en="Unit Converter" data-id="Konversi Satuan">Unit Converter</a></li>
                                <li><a href="../kalkulator-online/index.html" class="hover:underline font-bold" data-en="Business Calculator (Here)" data-id="Kalkulator Dagang (Disini)">Business Calculator (Here)</a></li>
                            </ul>
                        </div>
                    </div>
                </section>
        
            </div>
        </div>
    </main>
    
    <div id="ios-modal" class="fixed inset-0 bg-black bg-opacity-50 z-[100] hidden flex items-end sm:items-center justify-center p-4">
        <div class="bg-white rounded-t-2xl sm:rounded-2xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-800" id="iosModalTitle" data-id="Petunjuk Simpan URL (iOS)" data-en="Instructions to Save URL (iOS)">Instructions to Save URL (iOS)</h3>
                <button onclick="closeIosModal()" class="text-gray-500 text-2xl">&times;</button>
            </div>
            <div class="space-y-4 text-gray-600" id="iosModalContent" data-id="<p>1. Tekan tombol <strong>Share</strong> di bar bawah Safari.</p><p>2. Pilih <strong>'Add to Home Screen'</strong> (Tambah ke Layar Utama).</p><p>3. Tekan <strong>Add</strong>.</p>" data-en="<p>1. Tap the <strong>Share</strong> button at the bottom of Safari.</p><p>2. Select <strong>'Add to Home Screen'</strong>.</p><p>3. Tap <strong>Add</strong>.</p>">
                <p>1. Tekan tombol <strong>Share</strong> di bar bawah Safari.</p>
                <p>2. Pilih <strong>"Add to Home Screen"</strong> (Tambah ke Layar Utama).</p>
                <p>3. Tekan <strong>Add</strong>.</p>
            </div>
            <button onclick="closeIosModal()" class="mt-6 w-full bg-gray-200 text-gray-800 font-bold py-3 rounded-xl" data-id="Tutup" data-en="Close">Close</button>
        </div>
    </div>

    <div id="non-ios-modal" class="fixed inset-0 bg-black bg-opacity-50 z-[1000] hidden flex items-end sm:items-center justify-center p-4">
        <div class="bg-white rounded-t-2xl sm:rounded-2xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-800" id="nonIosModalTitle" data-id="Petunjuk Simpan URL" data-en="Save URL Instructions">Save URL Instructions</h3>
                <button onclick="closeNonIosModal()" class="text-gray-500 text-2xl">&times;</button>
            </div>
            <div class="space-y-4 text-gray-600" id="nonIosModalContent" 
                 data-id="<p>Fitur Simpan ke Layar Utama (Instalasi PWA) biasanya tersedia di menu browser Anda.</p><p>1. Cari ikon <strong>tiga titik vertikal (‚ãÆ)</strong> atau ikon <strong>Share</strong> di sudut kanan atas browser.</p><p>2. Pilih opsi <strong>'Instal Aplikasi'</strong> atau <strong>'Tambahkan ke Layar Utama'</strong>.</p><p>3. Untuk <strong>Desktop</strong>, gunakan fitur <strong>Bookmark</strong> atau cari opsi 'Instal' di Address Bar.</p>"
                 data-en="<p>The Add to Home Screen (PWA Install) feature is usually available in your browser's main menu.</p><p>1. Look for the <strong>vertical three dots (‚ãÆ)</strong> icon or the <strong>Share</strong> icon in the top right corner of your browser.</p><p>2. Select the option <strong>'Install App'</strong> or <strong>'Add to Home Screen'</strong>.</p><p>3. For <strong>Desktop</strong>, use the <strong>Bookmark</strong> feature or look for the 'Install' option in the Address Bar.</p>">
                <p>The Add to Home Screen (PWA Install) feature is usually available in your browser's main menu.</p>
                <p>1. Look for the <strong>vertical three dots (‚ãÆ)</strong> icon or the <strong>Share</strong> icon in the top right corner of your browser.</p>
                <p>2. Select the option <strong>'Install App'</strong> or <strong>'Add to Home Screen'</strong>.</p>
                <p>3. For <strong>Desktop</strong>, use the <strong>Bookmark</strong> feature or look for the 'Install' option in the Address Bar.</p>
            </div>
            <button onclick="closeNonIosModal()" class="mt-6 w-full bg-gray-200 text-gray-800 font-bold py-3 rounded-xl" data-id="Tutup" data-en="Close">Close</button>
        </div>
    </div>

    <div id="global-footer-container"></div>

    <script>
    window.headerCategory = 'productivity';
    </script>

    <script src="../components.js"></script>

    <script>
        // ==========================================
        // 1. FUNGSI TERBILANG (RUPIAH/DOLLAR)
        // ==========================================
        function terbilangID(a) {
            var bilangan = ['','Satu','Dua','Tiga','Empat','Lima','Enam','Tujuh','Delapan','Sembilan','Sepuluh','Sebelas'];
            var kalimat = "";
            a = Math.floor(a);
            if(a === 0) return "Nol";
            if(a < 0) return "Minus " + terbilangID(Math.abs(a));
            if(a < 12) { kalimat = bilangan[a]; } 
            else if (a < 20) { kalimat = terbilangID(a-10) + ' Belas'; } 
            else if (a < 100) { kalimat = terbilangID(Math.floor(a/10)) + ' Puluh ' + terbilangID(a%10); } 
            else if (a < 200) { kalimat = 'Seratus ' + terbilangID(a - 100); } 
            else if (a < 1000) { kalimat = terbilangID(Math.floor(a/100)) + ' Ratus ' + terbilangID(a%100); } 
            else if (a < 2000) { kalimat = 'Seribu ' + terbilangID(a - 1000); } 
            else if (a < 1000000) { kalimat = terbilangID(Math.floor(a/1000)) + ' Ribu ' + terbilangID(a%1000); } 
            else if (a < 1000000000) { kalimat = terbilangID(Math.floor(a/1000000)) + ' Juta ' + terbilangID(a%1000000); } 
            else if (a < 1000000000000) { kalimat = terbilangID(Math.floor(a/1000000000)) + ' Milyar ' + terbilangID(a%1000000000); } 
            else if (a < 1000000000000000) { kalimat = terbilangID(Math.floor(a/1000000000000)) + ' Triliun ' + terbilangID(a%1000000000000); }
            kalimat = kalimat.replace(/\sNol/g, '');
            return kalimat.replace(/\s+/g, ' ').trim();
        }
        
        function terbilangEN(n) {
            const units = ['', 'Thousand', 'Million', 'Billion', 'Trillion'];
            const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine', 'Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            if (n === 0) return 'Zero';
            let i = 0;
            let result = '';
            while (n > 0) {
                if (n % 1000 !== 0) {
                    result = terbilangHundreds(n % 1000) + ' ' + units[i] + ' ' + result;
                }
                n = Math.floor(n / 1000);
                i++;
            }
            function terbilangHundreds(num) {
                let current = '';
                if (num % 100 < 20) {
                    current += ones[num % 100];
                    num = Math.floor(num / 100);
                } else {
                    current += ones[num % 10];
                    num = Math.floor(num / 10);
                    current = tens[num % 10] + (current.trim() === '' ? '' : ' ') + current;
                    num = Math.floor(num / 10);
                }
                if (num > 0) {
                    current = ones[num] + ' Hundred ' + current;
                }
                return current.trim();
            }
            return result.replace(/\s+/g, ' ').trim();
        }

        // ==========================================
        // 2. LOGIKA UTAMA & FORMATTING
        // ==========================================
        let currentInput = '0';
        const display = document.getElementById('display');
        const historyList = document.getElementById('history-list');
        let lastResultRaw = 0; 
        let currentLang = 'en';

        function formatDisplayValue(raw) {
            const parts = raw.split(/([\+\-\*\/])/);
            const formattedParts = parts.map(part => {
                if (['+', '-', '*', '/'].includes(part)) { return part.replace('*', '√ó').replace('/', '√∑'); }
                if (!isNaN(part) && part !== '') {
                    const numberParts = part.split('.');
                    const integerPart = parseInt(numberParts[0] || '0').toLocaleString('id-ID'); 
                    return numberParts.length > 1 ? `${integerPart},${numberParts[1]}` : integerPart;
                }
                return part;
            });
            return formattedParts.join(' ');
        }

        function updateDisplay() {
            display.value = formatDisplayValue(currentInput);
            display.scrollLeft = display.scrollWidth;
        }

        function appendToDisplay(val) {
            const operators = ['+', '-', '*', '/'];
            const lastChar = currentInput.slice(-1);

            if (currentInput === '0' && !operators.includes(val) && val !== '.') {
                currentInput = val;
            } else if (operators.includes(val) && operators.includes(lastChar)) {
                currentInput = currentInput.slice(0, -1) + val;
            } else {
                currentInput += val;
            }
            updateDisplay();
        }

        function clearDisplay() {
            currentInput = '0';
            lastResultRaw = 0;
            updateDisplay();
            document.getElementById('terbilang').textContent = currentLang === 'id' ? 'Nol Rupiah' : 'Zero Dollar';
        }

        function deleteLast() {
            currentInput = currentInput.toString().slice(0, -1);
            if (currentInput === '') currentInput = '0';
            updateDisplay();
        }

        // ==========================================
        // 3. LOGIKA HITUNG, COPY, HISTORY, PDF
        // ==========================================
        function calculate() {
            try {
                const expressionRaw = currentInput;
                const expressionEval = currentInput.replace(/√ó/g, '*').replace(/√∑/g, '/');
                
                let result = eval(expressionEval);
                if (result !== undefined && isFinite(result)) {
                    result = parseFloat(result.toFixed(4));
                    lastResultRaw = result;
                    
                    addToHistory(expressionRaw, result);
                    
                    currentInput = result.toString();
                    updateDisplay();
                    
                    const terbilangFunc = currentLang === 'id' ? terbilangID : terbilangEN;
                    const currencyText = currentLang === 'id' ? " Rupiah" : " Dollar";
                    const textTerbilang = terbilangFunc(Math.floor(result)) + currencyText;
                    document.getElementById('terbilang').textContent = textTerbilang;
                } else {
                    display.value = "Error";
                    currentInput = '0';
                    document.getElementById('terbilang').textContent = currentLang === 'id' ? 'Nol Rupiah (Error)' : 'Zero Dollar (Error)';
                }
            } catch (e) {
                display.value = "Error";
                currentInput = '0';
                document.getElementById('terbilang').textContent = currentLang === 'id' ? 'Nol Rupiah (Error)' : 'Zero Dollar (Error)';
            }
        }

        function copyResult() {
            const resultToCopy = lastResultRaw !== 0 ?
                lastResultRaw.toString() : currentInput.replace(/[\.\,]/g, '');

            navigator.clipboard.writeText(resultToCopy)
                .then(() => {
                    display.value = "COPIED!";
                    setTimeout(updateDisplay, 500);
                })
                .catch(err => {
                    alert(currentLang === 'id' ? 'Gagal menyalin: ' + err : 'Failed to copy: ' + err);
                });
        }

        function addToHistory(calcRaw, res) {
            const historyItem = {
                id: Date.now(), calcRaw: calcRaw, result: res,
                time: new Date().toLocaleTimeString('id-ID', {hour: '2-digit', minute:'2-digit'}),
                date: new Date().toLocaleDateString('id-ID', {day: 'numeric', month: 'short'})
            };

            let history = JSON.parse(localStorage.getItem('calc_history') || '[]');
            history.unshift(historyItem);
            if (history.length > 50) history.pop();
            localStorage.setItem('calc_history', JSON.stringify(history));
            renderHistory();
        }

        function renderHistory() {
            const history = JSON.parse(localStorage.getItem('calc_history') || '[]');
            historyList.innerHTML = '';

            if (history.length === 0) {
                historyList.innerHTML = '<div class="flex flex-col items-center justify-center h-full text-gray-400 opacity-60">' + (currentLang === 'id' ? 'Belum ada data' : 'No data yet') + '</div>';
                return;
            }

            history.forEach(item => {
                const div = document.createElement('div');
                div.className = "border-b border-dashed border-gray-300 pb-2 mb-2 last:border-0";
                
                const formattedResult = new Intl.NumberFormat('id-ID').format(item.result);
                const formattedCalc = formatDisplayValue(item.calcRaw);

                div.innerHTML = `
                    <div class="flex justify-between text-xs text-gray-400 mb-1">
                        <span>${item.date}, ${item.time}</span>
                        <button onclick="printSpecificPDF('${item.calcRaw}', ${item.result})" class="text-blue-500 hover:text-blue-700">üñ®Ô∏è PDF</button>
                    </div>
                    <div class="text-right text-gray-600 text-sm mb-1">${formattedCalc}</div>
                    <div class="text-right font-bold text-gray-900 text-lg cursor-pointer hover:text-blue-600 transition" 
                        onclick="useResult('${item.result}')" title="${currentLang === 'id' ? 'Pakai angka ini' : 'Use this number'}">
                        = ${formattedResult}
                    </div>
                `;
                historyList.appendChild(div);
            });
        }

        function useResult(val) {
            if(currentInput === '0') currentInput = val.toString();
            else currentInput += val.toString();
            updateDisplay();
        }

        function clearHistory() {
            if(confirm(currentLang === 'id' ? "Hapus seluruh riwayat hitungan?" : "Clear all calculation history?")) {
                localStorage.removeItem('calc_history');
                renderHistory();
            }
        }

        function generateReceiptPDF(calcRaw, resultValue) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'portrait', unit: 'mm', format: [80, 200]
            });

            const parts = calcRaw.split(/([\+\-\*\/])/).filter(p => p.trim() !== "");
            doc.setFont("courier", "normal"); doc.setFontSize(10);
            let yPos = 10;
            const xPosRight = 75; const pageWidth = 80;

            doc.setFontSize(12); doc.setFont("courier", "bold");
            doc.text(currentLang === 'id' ? "Kalkulator Dagang" : "Business Calculator", pageWidth / 2, yPos, { align: "center" });
            yPos += 5;
            doc.setFontSize(8); doc.setFont("courier", "normal");
            doc.text(new Date().toLocaleString('id-ID'), pageWidth / 2, yPos, { align: "center" });
            yPos += 5;
            doc.line(5, yPos, 75, yPos);
            yPos += 5;

            doc.setFontSize(10);
            
            parts.forEach((part, index) => {
                let textToPrint = part;
                if (!isNaN(part) && part !== '') {
                    textToPrint = parseInt(part).toLocaleString('id-ID');
                } else {
                    textToPrint = part.replace('*', 'x').replace('/', ':');
                }
                
                if (['+', '-', 'x', ':'].includes(textToPrint)) {
                    doc.text(textToPrint, xPosRight, yPos, { align: "right" });
                    yPos += 5;
                } else {
                    doc.text(textToPrint, xPosRight, yPos, { align: "right" });
                    
                    const nextPart = parts[index + 1];
                    if(nextPart && ['+', '-', '*', '/'].includes(nextPart)) {
                        doc.text(nextPart.replace('*', 'x').replace('/', ':'), 5, yPos);
                    }
                    yPos += 5;
                }
            });
            doc.line(5, yPos, 75, yPos); yPos += 5;

            doc.setFont("courier", "bold"); doc.setFontSize(12);
            doc.text("= " + parseInt(resultValue).toLocaleString('id-ID'), xPosRight, yPos, { align: "right" });
            yPos += 7;

            doc.setFont("courier", "italic"); doc.setFontSize(8);
            const terbilangFunc = currentLang === 'id' ? terbilangID : terbilangEN;
            const currencyText = currentLang === 'id' ? " Rupiah" : " Dollar";
            const textTerbilang = terbilangFunc(Math.floor(resultValue)) + currencyText;
            const splitText = doc.splitTextToSize((currentLang === 'id' ? "Terbilang: " : "Spelled out: ") + textTerbilang, 70);
            doc.text(splitText, 5, yPos);
            
            doc.save(`struk-${Date.now()}.pdf`);
        }

        function printCurrentPDF() {
            if (!confirm(currentLang === 'id' ? "Apakah Anda yakin ingin mencetak/menyimpan PDF untuk hitungan ini?" : "Are you sure you want to print/save the PDF for this calculation?")) {
                return;
            }
            
            const hasOperator = /[\+\-\*\/]/.test(currentInput);
            if (hasOperator) {
                calculate();
            }

            const history = JSON.parse(localStorage.getItem('calc_history') || '[]');
            if (history.length > 0) {
                 setTimeout(() => {
                    generateReceiptPDF(history[0].calcRaw, history[0].result);
                 }, 50);
            } else if (!hasOperator && currentInput !== '0') {
                 setTimeout(() => {
                    generateReceiptPDF(currentInput, lastResultRaw);
                 }, 50);
            } else {
                alert(currentLang === 'id' ? "Silakan lakukan perhitungan yang valid terlebih dahulu." : "Please perform a valid calculation first.");
            }
        }

        function printSpecificPDF(calcRaw, result) {
            if (!confirm(currentLang === 'id' ? "Apakah Anda yakin ingin mencetak/menyimpan PDF untuk riwayat ini?" : "Are you sure you want to print/save the PDF for this history item?")) {
                return;
            }
            setTimeout(() => {
                generateReceiptPDF(calcRaw, result);
            }, 50);
        }

        function closeIosModal() { document.getElementById('ios-modal').classList.add('hidden'); }
        function closeNonIosModal() { document.getElementById('non-ios-modal').classList.add('hidden'); }

        function isIOS() {
            const userAgent = window.navigator.userAgent.toLowerCase();
            return /iphone|ipad|ipod/.test(userAgent) && !window.MSStream;
        }

        function showInstallInstructions() {
             const installCard = document.getElementById('install-card');
             const iosModal = document.getElementById('ios-modal');
             const nonIosModal = document.getElementById('non-ios-modal');
             
             if (isIOS()) {
                 iosModal.classList.remove('hidden');
             } else {
                 nonIosModal.classList.remove('hidden');
             }
             
             if (installCard) {
                installCard.classList.add('hidden'); 
             }
        }

        // ==========================================
        // 4. TRANSLATION LOGIC
        // ==========================================
        const translationData = {
            id: {
                appTitle: "Kalkulator Bisnis Online, Cetak Struk PDF & Terbilang Rupiah - Digital Tools ID",
                headerTitle: "Kalkulator Bisnis Online",
            },
            en: {
                appTitle: "Business & Receipt Calculator, PDF Receipt & Spell Out Feature - Digital Tools ID",
                headerTitle: "Online Business Calculator",
            }
        };
        
        function setLanguage(lang) {
            currentLang = lang;
            const t = translationData[lang];
            
            document.getElementById('appTitle').textContent = t.appTitle;
            
            document.querySelectorAll('[data-id], [data-en]').forEach(el => {
                const text = el.getAttribute(`data-${lang}`);
                const isInstallDesc = (el.id === 'labelInstallDesc');
                
                if (text) { 
                    if (isInstallDesc) {
                         el.innerHTML = text; 
                    } else {
                         el.textContent = text; 
                    }
                }
            });
            
            const iosContent = document.getElementById('iosModalContent');
            if (iosContent) {
                const contentHtml = iosContent.getAttribute(`data-${lang}`);
                if (contentHtml) iosContent.innerHTML = contentHtml;
            }
            const nonIosContent = document.getElementById('nonIosModalContent');
            if (nonIosContent) {
                const contentHtml = nonIosContent.getAttribute(`data-${lang}`);
                if (contentHtml) nonIosContent.innerHTML = contentHtml;
            }
            
            updateDisplay();
            renderHistory(); 

            if (lastResultRaw === 0) {
                document.getElementById('terbilang').textContent = lang === 'id' ? 'Nol Rupiah' : 'Zero Dollar';
            } else {
                const terbilangFunc = lang === 'id' ? terbilangID : terbilangEN;
                const currencyText = lang === 'id' ? " Rupiah" : " Dollar";
                const textTerbilang = terbilangFunc(Math.floor(lastResultRaw)) + currencyText;
                document.getElementById('terbilang').textContent = textTerbilang;
            }
        }

        // ==========================================
        // 5. INISIALISASI & MUTATION OBSERVER
        // ==========================================
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'attributes' && mutation.attributeName === 'lang') {
                    const newLang = document.documentElement.lang || 'en';
                    setLanguage(newLang);
                }
            });
        });
        observer.observe(document.documentElement, { attributes: true });

        document.addEventListener('DOMContentLoaded', () => {
            let initialLang = 'en'; 
            const initialHtmlLang = document.documentElement.lang;
            const browserLang = navigator.language || navigator.userLanguage;

            if (initialHtmlLang && (initialHtmlLang === 'id' || initialHtmlLang === 'en')) {
                initialLang = initialHtmlLang;
            } else if (browserLang.toLowerCase().startsWith('id')) {
                initialLang = 'id';
            }
            setLanguage(initialLang); 
        });
    </script>
</body>
</html>