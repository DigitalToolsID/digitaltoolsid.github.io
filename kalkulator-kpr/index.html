<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Judul akan di-set oleh JS -->
    <title id="appTitle">Kalkulator Cicilan KPR</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Kode Google Analytic dan Adsense -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7M8E7QRYNY"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-7M8E7QRYNY');
    </script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4885884866232864"
         crossorigin="anonymous"></script>
    
    <!-- Konfigurasi Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#2c3e50', 
                        'secondary': '#3498db', 
                        'primary-dark': '#1e3a8a', 
                        'finance-color': '#27ae60', // Hijau untuk Keuangan
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Gaya kustom untuk tampilan hasil */
        .result-box {
            transition: all 0.5s ease-in-out;
            transform-origin: top center;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
        }
        .result-box.visible {
            opacity: 1;
            max-height: 2000px; /* Diperbesar karena ada tabel amortisasi */
            padding: 1.5rem; 
        }
        
        /* Gaya Toggle Bahasa (Sama seperti alat lain) */
        .lang-toggle-container {
            position: relative;
            display: inline-flex;
            background-color: #e5e7eb; 
            border-radius: 9999px; 
            padding: 4px;
        }
        .lang-toggle-btn {
            padding: 6px 14px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            z-index: 10;
            color: #6b7280; 
            transition: color 0.3s ease;
            position: relative;
        }
        .lang-toggle-slider {
            position: absolute;
            top: 4px;
            left: 4px;
            height: calc(100% - 8px);
            width: calc(50% - 4px); 
            background-color: #1e3a8a; /* Primary-dark */
            border-radius: 9999px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 5;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        .lang-toggle-container.lang-en .lang-toggle-slider { transform: translateX(0%); }
        .lang-toggle-container.lang-id .lang-toggle-slider { transform: translateX(100%); }
        .lang-toggle-container.lang-en #lang-en { color: white; }
        .lang-toggle-container.lang-id #lang-id { color: white; }
        
        /* Gaya kustom untuk input dan tombol */
        .calculate-button {
            box-shadow: 0 4px #1e8449; /* Warna hijau yang lebih gelap */
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .calculate-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px #1e8449;
        }
        .calculate-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px #1e8449;
        }

        /* Gaya untuk deskripsi input */
        .input-description {
            font-size: 0.75rem; /* text-xs */
            color: #6b7280; /* text-gray-500 */
            margin-top: 0.25rem;
        }
        
        /* Gaya Tabel Amortisasi */
        .amortization-table-container {
            max-height: 400px; /* Batasi tinggi tabel agar bisa discroll */
            overflow-y: auto;
            margin-top: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
        }
        .amortization-table th, .amortization-table td {
            padding: 8px 12px;
            text-align: right;
            font-size: 0.75rem; /* text-xs */
            white-space: nowrap; /* Cegah pemotongan kolom */
        }
        .amortization-table th {
            background-color: #f3f4f6;
            font-weight: 600;
            position: sticky; /* Header tabel tetap di atas */
            top: 0;
            z-index: 10;
            text-align: center;
        }
        .amortization-table td:first-child {
            text-align: center;
        }
        
    </style>
</head>

<!-- Body dengan kode pengaman (Sama seperti alat lain) -->
<body class="bg-gray-50 flex flex-col min-h-screen font-sans" oncontextmenu="return false;" oncopy="return false;" oncut="return false;">

    <!-- Header -->
    <header class="bg-primary-dark text-white py-4 shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            
            <!-- Tautan Kembali ke Katalog (Path disesuaikan: naik 1 tingkat) -->
            <a href="../index.html" class="text-lg font-semibold tracking-tight text-gray-200 hover:text-white transition duration-150">
                &larr; <span id="backToCatalogText">Back to Tools Catalog</span>
            </a>
            
            <div id="languageSwitcher" class="lang-toggle-container lang-en">
                <div id="langToggleSlider" class="lang-toggle-slider"></div>
                <button id="lang-en" onclick="setLanguage('en')" class="lang-toggle-btn">
                    EN
                </button>
                <button id="lang-id" onclick="setLanguage('id')" class="lang-toggle-btn">
                    ID
                </button>
            </div>
            </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow p-4 sm:p-8 flex justify-center">
        <div class="w-full max-w-2xl bg-white shadow-xl rounded-xl p-6 sm:p-8">
            
            <h1 id="headerTitle" class="text-3xl font-extrabold text-primary-dark mb-3">Mortgage Loan (KPR) Calculator</h1>
            
            <p id="toolSubtitle" class="text-base text-gray-700 font-medium mb-6">
                Calculate your monthly installment, total interest paid, and visualize the amortization schedule.
            </p>
            
            <!-- Form Input -->
            <form id="kprForm" onsubmit="calculateKpr(event)" class="space-y-4">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="relative">
                        <label for="loanAmount" class="block text-sm font-medium text-gray-700 mb-1" id="labelLoanAmount">Loan Amount</label>
                        <input type="text" id="loanAmount" inputmode="numeric" value="500.000.000" oninput="formatInput(this)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-finance-color focus:border-finance-color transition duration-150" required>
                        <p class="input-description" id="descLoanAmount">Total pokok pinjaman yang Anda ajukan.</p>
                    </div>
                    
                    <div class="relative">
                        <label for="interestRate" class="block text-sm font-medium text-gray-700 mb-1" id="labelInterestRate">Annual Interest Rate (%)</label>
                        <input type="number" id="interestRate" min="0" step="0.1" value="8" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-finance-color focus:border-finance-color transition duration-150" required>
                        <p class="input-description" id="descInterestRate">Suku bunga tahunan KPR/Kredit (contoh: 8 untuk 8%).</p>
                    </div>
                </div>

                <div class="relative">
                    <label for="loanTermYears" class="block text-sm font-medium text-gray-700 mb-1" id="labelLoanTerm">Loan Term (Years)</label>
                    <input type="number" id="loanTermYears" min="1" max="30" value="15" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-finance-color focus:border-finance-color transition duration-150" required>
                    <p class="input-description" id="descLoanTerm">Jangka waktu pinjaman total dalam tahun (Maks. 30 Tahun).</p>
                </div>


                <button type="submit" id="calculateButton" class="calculate-button w-full bg-finance-color text-white font-semibold py-3 rounded-xl hover:bg-green-700 transition duration-300 ease-in-out transform focus:outline-none focus:ring-4 focus:ring-finance-color focus:ring-opacity-50">
                    Calculate Installment
                </button>
                
                <!-- Error Alert -->
                <div id="errorAlert" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
                    <span id="errorText" class="block sm:inline"></span>
                </div>
            </form>

            <!-- Result Box -->
            <div id="resultBox" class="result-box mt-6 bg-finance-color/5 border border-finance-color/30 rounded-xl shadow-lg">
                
                <h3 id="resultHeader" class="text-xl font-bold mb-4 text-primary border-b pb-2">Loan Summary</h3>
                
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                    <div class="p-4 bg-green-50 border border-green-200 rounded-lg col-span-1 sm:col-span-3">
                        <p id="labelMonthlyPayment" class="text-sm text-green-800 font-medium mb-1">Monthly Installment (Cicilan Bulanan)</pre>
                        <p id="monthlyPaymentResult" class="text-3xl font-extrabold text-finance-color">0</p>
                    </div>
                    
                    <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                        <p id="labelTotalPrincipal" class="text-sm text-gray-800 font-medium mb-1">Total Loan Principal</p>
                        <p id="totalPrincipalResult" class="text-xl font-bold text-gray-700">0</p>
                    </div>
                    
                    <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <p id="labelTotalInterest" class="text-sm text-yellow-800 font-medium mb-1">Total Interest Paid</p>
                        <p id="totalInterestResult" class="text-xl font-bold text-yellow-700">0</p>
                    </div>
                    
                    <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                        <p id="labelTotalCost" class="text-sm text-red-800 font-medium mb-1">Total Loan Cost (Principal + Interest)</p>
                        <p id="totalCostResult" class="text-xl font-bold text-red-700">0</p>
                    </div>
                </div>

                <!-- Tabel Amortisasi -->
                <h3 id="amortizationHeader" class="text-lg font-bold text-primary border-b pb-2 mb-2">Amortization Schedule (Monthly Breakdown)</h3>
                <div class="amortization-table-container shadow-inner">
                    <table class="amortization-table w-full">
                        <thead>
                            <tr>
                                <th id="tableHeaderMonth">Month</th>
                                <th id="tableHeaderPayment">Payment</th>
                                <th id="tableHeaderPrincipal">Principal</th>
                                <th id="tableHeaderInterest">Interest</th>
                                <th id="tableHeaderBalance">Balance</th>
                            </tr>
                        </thead>
                        <tbody id="amortizationTableBody">
                            <!-- Rows will be dynamically inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Konten Edukasi -->
            <section class="mt-8 pt-4 border-t border-gray-200 font-sans">
                <h2 id="sectionHeader1" class="text-xl font-bold text-gray-800 mb-3">Understanding Your Mortgage (KPR)</h2>
                <p id="content1" class="text-gray-600 text-sm leading-relaxed text-justify mb-6"></p>

                <h3 id="sectionHeader2" class="text-lg font-bold text-gray-800 mb-2">How Amortization Works</h3>
                <p id="content2" class="text-gray-600 text-sm leading-relaxed text-justify mb-6"></p>

                <h3 id="sectionHeader3" class="text-lg font-bold text-gray-800 mb-2">Tips for Choosing the Right Loan</h3>
                <ul id="content3" class="text-gray-600 text-sm leading-relaxed text-justify mb-6 list-disc ml-6 space-y-1">
                    <li id="tip1"></li>
                    <li id="tip2"></li>
                    <li id="tip3"></li>
                </ul>

                <h3 id="sectionHeader4" class="text-lg font-bold text-gray-800 mb-2">Disclaimer</h3>
                <p id="content4" class="text-gray-600 text-sm leading-relaxed text-justify mb-6"></p>
            </section>

        </div>
    </main>
    
    <!-- Footer (Sama seperti alat lain) -->
    <footer class="mt-12 py-6 border-t border-gray-200 bg-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div id="footerLinks" class="flex flex-wrap justify-center space-x-4 sm:space-x-8 text-sm font-medium text-gray-600">
                <a href="../privacy-policy.html" id="linkPrivacy" class="hover:text-secondary transition duration-150 ease-in-out">Privacy Policy</a>
                <span aria-hidden="true" class="hidden sm:inline">|</span>
                <a href="../terms-of-service.html" id="linkTerms" class="hover:text-secondary transition duration-150 ease-in-out">Terms of Service</a>
                <span aria-hidden="true" class="hidden sm:inline">|</span>
                <a href="../about-us.html" id="linkAbout" class="hover:text-secondary transition duration-150 ease-in-out">About Us</a>
                <span aria-hidden="true" class="hidden sm:inline">|</span>
                <a href="../contact-us.html" id="linkContact" class="hover:text-secondary transition duration-150 ease-in-out">Contact Us</a>
            </div>
            
            <div class="mt-6 text-center text-xs text-gray-500">
                <span id="footerCopyright">&copy; 2025 Digital Tools ID. All rights reserved. Developed by DTID Analytics.</span>
            </div>
        </div>
    </footer>
    
    <script>
        // **********************************************
        // LOGIKA KALKULATOR KPR / AMORTISASI
        // **********************************************

        const translations = {
            id: {
                appTitle: "Kalkulator Cicilan KPR",
                headerTitle: "Kalkulator Cicilan KPR & Amortisasi",
                toolSubtitle: "Hitung angsuran bulanan Anda, total bunga yang dibayar, dan visualisasikan jadwal amortisasi pinjaman.",
                backToCatalogText: "Kembali ke Katalog Alat",
                // Input
                labelLoanAmount: "Jumlah Pinjaman",
                descLoanAmount: "Total pokok pinjaman yang Anda ajukan untuk properti.",
                labelInterestRate: "Suku Bunga Tahunan (%)",
                descInterestRate: "Suku bunga tahunan KPR/Kredit (contoh: 8 untuk 8%).",
                labelLoanTerm: "Jangka Waktu Pinjaman (Tahun)",
                descLoanTerm: "Jangka waktu pinjaman total dalam tahun (Maks. 30 Tahun).",
                calculateButton: "Hitung Angsuran",
                inputError: "Mohon masukkan semua nilai input yang valid (Jumlah Pinjaman > 0, Bunga >= 0, Jangka Waktu 1-30 Tahun).",
                // Hasil
                resultHeader: "Ringkasan Pinjaman",
                labelMonthlyPayment: "Angsuran Bulanan",
                labelTotalPrincipal: "Total Pokok Pinjaman",
                labelTotalInterest: "Total Bunga Dibayar",
                labelTotalCost: "Total Biaya Pinjaman (Pokok + Bunga)",
                amortizationHeader: "Jadwal Amortisasi (Rincian Bulanan)",
                // Tabel Amortisasi
                tableHeaderMonth: "Bulan",
                tableHeaderPayment: "Angsuran",
                tableHeaderPrincipal: "Pokok",
                tableHeaderInterest: "Bunga",
                tableHeaderBalance: "Sisa Pokok",

                // Konten Edukasi
                sectionHeader1: "Memahami KPR (Kredit Pemilikan Rumah)",
                content1: "KPR adalah fasilitas pinjaman jangka panjang yang dirancang untuk membantu Anda membeli atau membangun properti. Memahami elemen-elemen seperti Pokok Pinjaman, Bunga, dan Jangka Waktu sangat penting, karena KPR merupakan komitmen finansial besar yang dapat memengaruhi kesehatan keuangan Anda selama bertahun-tahun. Kalkulator ini memberikan transparansi penuh tentang bagaimana setiap komponen dihitung.",
                
                sectionHeader2: "Cara Kerja Amortisasi",
                content2: "Amortisasi adalah proses melunasi utang (pinjaman) dari waktu ke waktu melalui pembayaran reguler yang tetap. Pada awal masa pinjaman, porsi terbesar dari Angsuran Bulanan Anda dialokasikan untuk membayar Bunga, dan hanya sedikit untuk Pokok Pinjaman. Seiring berjalannya waktu, alokasi bergeser: porsi Bunga berkurang, dan porsi Pokok Pinjaman meningkat, memastikan pinjaman lunas tepat pada akhir jangka waktu.",
                
                sectionHeader3: "Tips Memilih Pinjaman yang Tepat",
                content3: "Beberapa tips untuk mengelola pinjaman Anda:",
                tip1: "Pertimbangkan Tenor Pendek: Semakin pendek jangka waktu pinjaman (tenor), semakin kecil total bunga yang Anda bayar, meskipun angsuran bulanan akan lebih tinggi.",
                tip2: "Bandingkan Suku Bunga Efektif: Jangan hanya melihat angka bunga, pahami apakah suku bunga bersifat tetap (fixed) atau mengambang (floating), dan bandingkan biaya tahunan efektif dari beberapa bank.",
                tip3: "Perhatikan Biaya Awal: Selalu masukkan biaya-biaya lain seperti biaya provisi, administrasi, asuransi, dan notaris dalam perhitungan total biaya kepemilikan rumah.",
                
                sectionHeader4: "Penting (Disclaimer)",
                content4: "Kalkulator ini menggunakan metode perhitungan anuitas standar (bunga flat) untuk tujuan estimasi. Hasil yang disajikan belum termasuk biaya KPR di muka, pajak, asuransi, atau biaya lain yang mungkin dikenakan oleh bank atau lembaga keuangan. Hasil ini murni estimasi dan bukan merupakan penawaran pinjaman yang mengikat. Selalu verifikasi perhitungan Anda dengan penyedia KPR resmi.",

                // Footer
                linkPrivacy: "Kebijakan Privasi",
                linkTerms: "Ketentuan Layanan",
                linkAbout: "Tentang Kami",
                linkContact: "Hubungi Kami",
                footerCopyright: "&copy; 2025 Digital Tools ID. Semua hak dilindungi. Dikembangkan oleh DTID Analytics."
            },
            en: {
                appTitle: "Mortgage Loan Calculator",
                headerTitle: "Mortgage Loan (KPR) & Amortization Calculator",
                toolSubtitle: "Calculate your monthly installment, total interest paid, and visualize the amortization schedule.",
                backToCatalogText: "Back to Tools Catalog",
                // Input
                labelLoanAmount: "Loan Amount",
                descLoanAmount: "The total principal amount you are borrowing for the property.",
                labelInterestRate: "Annual Interest Rate (%)",
                descInterestRate: "The annual interest rate of the mortgage/loan (e.g.: 8 for 8%).",
                labelLoanTerm: "Loan Term (Years)",
                descLoanTerm: "The total duration of the loan in years (Max 30 Years).",
                calculateButton: "Calculate Installment",
                inputError: "Please enter all valid input values (Loan Amount > 0, Interest >= 0, Term 1-30 Years).",
                // Hasil
                resultHeader: "Loan Summary",
                labelMonthlyPayment: "Monthly Installment",
                labelTotalPrincipal: "Total Loan Principal",
                labelTotalInterest: "Total Interest Paid",
                labelTotalCost: "Total Loan Cost (Principal + Interest)",
                amortizationHeader: "Amortization Schedule (Monthly Breakdown)",
                // Tabel Amortisasi
                tableHeaderMonth: "Month",
                tableHeaderPayment: "Payment",
                tableHeaderPrincipal: "Principal",
                tableHeaderInterest: "Interest",
                tableHeaderBalance: "Balance",
                
                // Konten Edukasi
                sectionHeader1: "Understanding Your Mortgage (KPR)",
                content1: "A mortgage (KPR) is a long-term loan facility designed to help you purchase or build property. Understanding elements like the Principal, Interest, and Loan Term is crucial, as a mortgage is a huge financial commitment that can affect your financial health for many years. This calculator provides full transparency on how each component is calculated.",
                
                sectionHeader2: "How Amortization Works",
                content2: "Amortization is the process of paying off debt (loan) over time through regular, fixed payments. Early in the loan term, the largest portion of your Monthly Installment is allocated to paying Interest, with only a small portion going toward the Principal. Over time, the allocation shifts: the Interest portion decreases, and the Principal portion increases, ensuring the loan is paid off precisely by the end of the term.",
                
                sectionHeader3: "Tips for Choosing the Right Loan",
                content3: "Some tips for managing your loan:",
                tip1: "Consider a Shorter Tenor: The shorter the loan term (tenor), the less total interest you will pay, although the monthly installment will be higher.",
                tip2: "Compare Effective Interest Rates: Don't just look at the rate number; understand if the rate is fixed or floating, and compare the effective annual cost from several banks.",
                tip3: "Mind the Upfront Costs: Always factor in other costs like provision fees, administration, insurance, and notary fees into the total cost calculation of homeownership.",
                
                sectionHeader4: "Disclaimer",
                content4: "This calculator uses the standard annuity calculation method (flat interest) for estimation purposes. The results presented do not include upfront mortgage fees, taxes, insurance, or other charges that may be imposed by the bank or financial institution. This result is purely an estimate and does not constitute a binding loan offer. Always verify your calculations with the official KPR provider.",
                
                // Footer
                linkPrivacy: "Privacy Policy",
                linkTerms: "Terms of Service",
                linkAbout: "About Us",
                linkContact: "Contact Us",
                footerCopyright: "&copy; 2025 Digital Tools ID. All rights reserved. Developed by DTID Analytics."
            }
        };

        let currentLang = 'en'; // Default language

        // Fungsi utilitas untuk memformat angka dengan pemisah ribuan (tanpa simbol mata uang)
        function formatNumber(amount) {
            const locale = currentLang === 'id' ? 'id-ID' : 'en-US';
            return new Intl.NumberFormat(locale, {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0,
            }).format(amount);
        }

        // Fungsi yang dipanggil oleh event oninput untuk memformat input secara real-time
        function formatInput(inputElement) {
            // Hapus semua non-digit untuk mendapatkan nilai mentah
            let rawValue = inputElement.value.replace(/\D/g, ''); 
            
            // Konversi ke angka, lalu format, lalu kembalikan ke input value
            if (rawValue) {
                const numericValue = parseInt(rawValue, 10);
                inputElement.value = formatNumber(numericValue);
            } else {
                inputElement.value = ''; // Biarkan kosong jika tidak ada input
            }
        }
        
        // Fungsi untuk membersihkan format dari input string (misalnya "10.000.000" menjadi 10000000)
        function cleanInput(formattedValue) {
            // Menghapus semua karakter non-digit (termasuk titik/koma pemisah ribuan)
            return parseFloat(formattedValue.replace(/\D/g, '')) || 0;
        }

        // Fungsi untuk merender tabel amortisasi
        function renderAmortizationTable(amortizationData) {
            const tbody = document.getElementById('amortizationTableBody');
            tbody.innerHTML = '';
            
            amortizationData.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-gray-100 hover:bg-gray-50';

                // Kolom Bulan
                const tdMonth = document.createElement('td');
                tdMonth.textContent = row.month;
                tr.appendChild(tdMonth);

                // Kolom Angsuran (Payment)
                const tdPayment = document.createElement('td');
                tdPayment.textContent = formatNumber(row.payment);
                tr.appendChild(tdPayment);

                // Kolom Pokok (Principal)
                const tdPrincipal = document.createElement('td');
                tdPrincipal.textContent = formatNumber(row.principal);
                tr.appendChild(tdPrincipal);

                // Kolom Bunga (Interest)
                const tdInterest = document.createElement('td');
                tdInterest.textContent = formatNumber(row.interest);
                tr.appendChild(tdInterest);

                // Kolom Sisa Pokok (Balance)
                const tdBalance = document.createElement('td');
                tdBalance.textContent = formatNumber(row.balance);
                tr.appendChild(tdBalance);

                tbody.appendChild(tr);
            });
        }


        // Fungsi utama untuk menghitung KPR
        function calculateKpr(event) {
            event.preventDefault();

            // 1. Ambil dan Bersihkan Input
            const L = cleanInput(document.getElementById('loanAmount').value); // Loan Amount (Pokok Pinjaman)
            const R_annual = parseFloat(document.getElementById('interestRate').value) / 100; // Annual Interest Rate (Bunga Tahunan Desimal)
            const T_years = parseInt(document.getElementById('loanTermYears').value) || 0; // Loan Term (Tahun)

            const resultBox = document.getElementById('resultBox');
            const errorAlert = document.getElementById('errorAlert');

            // 2. Validasi Input
            if (L <= 0 || R_annual < 0 || T_years < 1 || T_years > 30) {
                document.getElementById('errorText').textContent = translations[currentLang].inputError;
                errorAlert.classList.remove('hidden');
                resultBox.classList.remove('visible');
                return;
            }
            
            errorAlert.classList.add('hidden');
            
            // 3. Konversi ke Nilai Bulanan
            const R_monthly = R_annual / 12; // Monthly Interest Rate
            const N_months = T_years * 12; // Total Number of Payments (Bulan)
            
            let monthlyPayment = 0;
            
            // 4. Hitung Angsuran Bulanan (M) menggunakan Formula Cicilan Anuitas
            // M = P * [ r(1 + r)^n ] / [ (1 + r)^n â€“ 1 ]
            if (R_monthly > 0) {
                const powerFactor = Math.pow(1 + R_monthly, N_months);
                monthlyPayment = L * (R_monthly * powerFactor) / (powerFactor - 1);
            } else {
                // Jika bunga 0%
                monthlyPayment = L / N_months;
            }

            // 5. Hitung Amortisasi dan Total Biaya
            let remainingBalance = L;
            let totalInterestPaid = 0;
            const amortizationSchedule = [];

            for (let month = 1; month <= N_months; month++) {
                // Hitung Bunga untuk bulan ini: Bunga = Sisa Pokok * Bunga Bulanan
                const interestPayment = remainingBalance * R_monthly;
                
                // Hitung Pembayaran Pokok: Pokok = Angsuran Bulanan - Bunga
                let principalPayment = monthlyPayment - interestPayment;

                // Adjust the last payment to clear the remaining balance if necessary
                if (month === N_months) {
                    principalPayment = remainingBalance;
                    monthlyPayment = remainingBalance + interestPayment;
                }

                // Update Sisa Pokok Pinjaman
                remainingBalance -= principalPayment;
                totalInterestPaid += interestPayment;

                // Membulatkan hasil ke angka terdekat (integer) untuk tampilan
                amortizationSchedule.push({
                    month: month,
                    payment: Math.round(monthlyPayment),
                    principal: Math.round(principalPayment),
                    interest: Math.round(interestPayment),
                    balance: Math.round(Math.max(0, remainingBalance)) // Pastikan sisa pokok tidak negatif
                });
                
                if (remainingBalance <= 0.01) { 
                    remainingBalance = 0;
                    break;
                }
            }
            
            const totalCost = L + totalInterestPaid;
            
            // 6. Tampilkan Ringkasan Hasil (Round ke integer terdekat)
            document.getElementById('monthlyPaymentResult').textContent = formatNumber(Math.round(monthlyPayment));
            document.getElementById('totalPrincipalResult').textContent = formatNumber(Math.round(L));
            document.getElementById('totalInterestResult').textContent = formatNumber(Math.round(totalInterestPaid));
            document.getElementById('totalCostResult').textContent = formatNumber(Math.round(totalCost));

            // 7. Render Tabel Amortisasi
            renderAmortizationTable(amortizationSchedule);

            // Tampilkan kotak hasil
            resultBox.classList.add('visible');
        }


        // Fungsi untuk mengubah semua teks UI berdasarkan bahasa
        function setLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            const languageSwitcher = document.getElementById('languageSwitcher');

            // Update status toggle
            languageSwitcher.classList.remove('lang-en', 'lang-id');
            languageSwitcher.classList.add(`lang-${lang}`);
            document.documentElement.lang = lang; 

            // Ambil nilai input yang sudah diformat
            const lValue = document.getElementById('loanAmount').value;

            // Update teks statis
            document.getElementById('appTitle').textContent = t.appTitle;
            document.getElementById('headerTitle').textContent = t.headerTitle;
            document.getElementById('toolSubtitle').textContent = t.toolSubtitle;
            document.getElementById('backToCatalogText').textContent = t.backToCatalogText;
            
            // Update label formulir dan tombol
            document.getElementById('labelLoanAmount').textContent = t.labelLoanAmount;
            document.getElementById('descLoanAmount').textContent = t.descLoanAmount;
            document.getElementById('labelInterestRate').textContent = t.labelInterestRate;
            document.getElementById('descInterestRate').textContent = t.descInterestRate;
            document.getElementById('labelLoanTerm').textContent = t.labelLoanTerm;
            document.getElementById('descLoanTerm').textContent = t.descLoanTerm;
            document.getElementById('calculateButton').textContent = t.calculateButton;

            // Format ulang input value (Loan Amount) berdasarkan bahasa baru
            document.getElementById('loanAmount').value = formatNumber(cleanInput(lValue));
            
            // Update label hasil
            document.getElementById('resultHeader').textContent = t.resultHeader;
            document.getElementById('labelMonthlyPayment').textContent = t.labelMonthlyPayment;
            document.getElementById('labelTotalPrincipal').textContent = t.labelTotalPrincipal;
            document.getElementById('labelTotalInterest').textContent = t.labelTotalInterest;
            document.getElementById('labelTotalCost').textContent = t.labelTotalCost;
            document.getElementById('amortizationHeader').textContent = t.amortizationHeader;

            // Update header tabel
            document.getElementById('tableHeaderMonth').textContent = t.tableHeaderMonth;
            document.getElementById('tableHeaderPayment').textContent = t.tableHeaderPayment;
            document.getElementById('tableHeaderPrincipal').textContent = t.tableHeaderPrincipal;
            document.getElementById('tableHeaderInterest').textContent = t.tableHeaderInterest;
            document.getElementById('tableHeaderBalance').textContent = t.tableHeaderBalance;

            // Update Konten Edukasi
            document.getElementById('sectionHeader1').textContent = t.sectionHeader1;
            document.getElementById('content1').innerHTML = t.content1;
            document.getElementById('sectionHeader2').textContent = t.sectionHeader2;
            document.getElementById('content2').innerHTML = t.content2;
            document.getElementById('sectionHeader3').textContent = t.sectionHeader3;
            // Tips
            document.getElementById('tip1').textContent = t.tip1;
            document.getElementById('tip2').textContent = t.tip2;
            document.getElementById('tip3').textContent = t.tip3;
            document.getElementById('sectionHeader4').textContent = t.sectionHeader4;
            document.getElementById('content4').innerHTML = t.content4;
            
            // Update Footer
            document.getElementById('linkPrivacy').textContent = t.linkPrivacy;
            document.getElementById('linkTerms').textContent = t.linkTerms;
            document.getElementById('linkAbout').textContent = t.linkAbout;
            document.getElementById('linkContact').textContent = t.linkContact;
            document.getElementById('footerCopyright').innerHTML = t.footerCopyright;

            // Format ulang hasil jika sudah ada
            const resultElement = document.getElementById('monthlyPaymentResult');
            if (resultElement.textContent !== '0') {
                 // Panggil kembali fungsi hitung untuk me-refresh format angka dan tabel
                 calculateKpr({ preventDefault: () => {} }); 
            }

             // Pastikan error message diupdate
            if (!document.getElementById('errorAlert').classList.contains('hidden')) {
                document.getElementById('errorText').textContent = t.inputError;
            }
        }
        
        // Event listener untuk perubahan bahasa
        document.getElementById('languageSwitcher').addEventListener('click', (event) => {
            if (event.target.tagName === 'BUTTON') {
                const newLang = event.target.id === 'lang-en' ? 'en' : 'id';
                if (newLang !== currentLang) {
                    setLanguage(newLang);
                    // Sembunyikan hasil saat bahasa berganti
                    document.getElementById('resultBox').classList.remove('visible');
                    document.getElementById('errorAlert').classList.add('hidden');
                }
            }
        });

        // Inisialisasi
        document.addEventListener('DOMContentLoaded', () => {
            // Logika Deteksi Bahasa Awal
            let defaultLang = 'en'; 
            const browserLang = (navigator.language || navigator.userLanguage).toLowerCase();
            if (browserLang.startsWith('id')) {
                defaultLang = 'id';
            }
            setLanguage(defaultLang); 
        });

    </script>
</body>
</html>